<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><meta name="emotion-insertion-point" content=""/><title>android 初次尝试Open GL.md<!-- --> - BruceWind&#x27;s Blog</title><meta name="description" content="android 初次尝试Open GL.md - 几年后回看会觉得写的太烂"/><meta property="og:title" content="android 初次尝试Open GL.md"/><meta property="og:type" content="article"/><meta property="article:published_time" content=" 2016/07/06 12:36:30"/><meta name="next-head-count" content="8"/><meta charSet="utf-8"/><meta name="keywords" content="NDK,JNI,Android Dev,android,androidyuan,性能优化,Linux,developer"/><meta name="description" content="BruceWind&#x27;s personal blog - Android development, Linux, and more."/><meta name="robots" content="index,follow"/><meta name="google" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="author" content="bruce"/><link rel="icon" href="/favicon.ico"/><meta name="theme-color" content="#000000"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LGE1LT9YJG"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-LGE1LT9YJG');
              </script><style data-emotion="mui-style-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-style 17ro72p 1cp6o32 79elbk 1qo0fs4 1uf4bbi 1m9pwf3 19gndve 1ju1kxc k1u9gz 6xugel 1k33q06 gtvj52 1x1vlev vax71z">.mui-style-17ro72p{width:100%;min-height:100vh;background-color:#fff;padding:16px;}.mui-style-1cp6o32{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12);padding:24px;}.mui-style-79elbk{position:relative;}.mui-style-1qo0fs4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;width:58px;height:38px;overflow:hidden;padding:12px;box-sizing:border-box;position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;z-index:0;vertical-align:middle;width:62px;height:34px;padding:7px;margin:8px;}@media print{.mui-style-1qo0fs4{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1qo0fs4 .MuiSwitch-switchBase{margin:1px;padding:0;-webkit-transform:translateX(6px);-moz-transform:translateX(6px);-ms-transform:translateX(6px);transform:translateX(6px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked{color:#fff;-webkit-transform:translateX(22px);-moz-transform:translateX(22px);-ms-transform:translateX(22px);transform:translateX(22px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked .MuiSwitch-thumb:before{background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><path d="M0 0h24v24H0z" fill="none"/><path fill="white" d="M12 19a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5.5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm11 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13 2v2h6v2h-1.968a18.222 18.222 0 0 1-3.621 6.302 14.685 14.685 0 0 0 5.327 3.042l-.536 1.93A16.685 16.685 0 0 1 12 13.726a16.696 16.696 0 0 1-6.202 3.547l-.536-1.929a14.7 14.7 0 0 0 5.327-3.042 18.077 18.077 0 0 1-2.822-4.3h2.24A16.031 16.031 0 0 0 12 10.876a16.168 16.168 0 0 0 2.91-4.876L5 6V4h6V2h2z"/></g></svg>');}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked+.MuiSwitch-track{opacity:1;background-color:#aab4be;}.mui-style-1qo0fs4 .MuiSwitch-thumb{background-color:#001e3c;width:32px;height:32px;}.mui-style-1qo0fs4 .MuiSwitch-thumb:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none" /><path fill="white" d="M14 10h2v.757a4.5 4.5 0 0 1 7 3.743V20h-2v-5.5c0-1.43-1.175-2.5-2.5-2.5S16 13.07 16 14.5V20h-2V10zm-2-6v2H4v5h8v2H4v5h8v2H2V4h10z"/></svg>');}.mui-style-1qo0fs4 .MuiSwitch-track{opacity:1;background-color:#aab4be;border-radius:10px;}.mui-style-1uf4bbi{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;padding:9px;border-radius:50%;position:absolute;top:0;left:0;z-index:1;color:#fff;-webkit-transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,-webkit-transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.mui-style-1uf4bbi::-moz-focus-inner{border-style:none;}.mui-style-1uf4bbi.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-1uf4bbi{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1uf4bbi.Mui-checked{-webkit-transform:translateX(20px);-moz-transform:translateX(20px);-ms-transform:translateX(20px);transform:translateX(20px);}.mui-style-1uf4bbi.Mui-disabled{color:#f5f5f5;}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{opacity:0.5;}.mui-style-1uf4bbi.Mui-disabled+.MuiSwitch-track{opacity:0.12;}.mui-style-1uf4bbi .MuiSwitch-input{left:-100%;width:300%;}.mui-style-1uf4bbi:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.mui-style-1uf4bbi:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked{color:#1976d2;}.mui-style-1uf4bbi.Mui-checked:hover{background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-1uf4bbi.Mui-checked:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked.Mui-disabled{color:rgb(167, 202, 237);}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{background-color:#1976d2;}.mui-style-1m9pwf3{cursor:inherit;position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;margin:0;padding:0;z-index:1;}.mui-style-19gndve{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);background-color:currentColor;width:20px;height:20px;border-radius:50%;}.mui-style-1ju1kxc{height:100%;width:100%;border-radius:7px;z-index:-1;-webkit-transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;background-color:#000;opacity:0.38;}.mui-style-k1u9gz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;margin-bottom:16px;}.mui-style-k1u9gz::-moz-focus-inner{border-style:none;}.mui-style-k1u9gz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-k1u9gz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-k1u9gz:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-k1u9gz:hover{background-color:transparent;}}.mui-style-k1u9gz.Mui-disabled{color:rgba(0, 0, 0, 0.26);}.mui-style-6xugel{display:inherit;margin-right:8px;margin-left:-4px;}.mui-style-6xugel>*:nth-of-type(1){font-size:20px;}.mui-style-1k33q06{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.25rem;}.mui-style-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}.mui-style-1x1vlev{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;margin-bottom:0.35em;color:rgba(0, 0, 0, 0.6);}.mui-style-vax71z{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;margin-top:16px;margin-bottom:16px;}</style><link rel="preload" href="/_next/static/css/345ff263c1768dbb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/345ff263c1768dbb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-5b2299ded1a46c83.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4f0aaa3a6ba99024.js" defer=""></script><script src="/_next/static/chunks/34-75ae01f5fa578a9a.js" defer=""></script><script src="/_next/static/chunks/995-1a3bc1a098c2d99b.js" defer=""></script><script src="/_next/static/chunks/771-6a778ea1fc3e748f.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blang%5D/blog/%5Bslug%5D-0f929ec094b5fc83.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_buildManifest.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="MuiBox-root mui-style-17ro72p"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation3 mui-style-1cp6o32"><div class="MuiBox-root mui-style-79elbk"><div style="position:fixed;top:22px;right:15px;z-index:1300"><span class="MuiSwitch-root MuiSwitch-sizeMedium mui-style-1qo0fs4"><span class="MuiButtonBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked PrivateSwitchBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked Mui-checked mui-style-1uf4bbi"><input class="PrivateSwitchBase-input MuiSwitch-input mui-style-1m9pwf3" type="checkbox" checked=""/><span class="MuiSwitch-thumb mui-style-19gndve"></span></span><span class="MuiSwitch-track mui-style-1ju1kxc"></span></span></div><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary mui-style-k1u9gz" tabindex="0" href="/cn/"><span class="MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium mui-style-6xugel"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall mui-style-1k33q06" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"></path></svg></span>返回列表</a><h1 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom mui-style-gtvj52">android 初次尝试Open GL.md</h1><p class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom mui-style-1x1vlev">几年后回看会觉得写的太烂<!-- --> | <!-- --> 2016/07/06 12:36:30</p><hr class="MuiDivider-root MuiDivider-fullWidth mui-style-vax71z"/><div class="markdown-body"><p>title: android 初次尝试Open GL
date: 2016/07/06 12:36:30
updated: 2016/07/09 16:38:12
categories:</p>
<ul>
<li>技术</li>
</ul>
<hr/>
<p>首先要考虑设备支持问题。如下是各个android 版本的支持：
android 官方给的答案：</p>
<blockquote>
<ul>
<li>OpenGL ES 1.0 and 1.1 - This API specification is supported by Android 1.0 and higher.</li>
<li>OpenGL ES 2.0 - This API specification is supported by Android 2.2 (API level 8) and higher.</li>
<li>OpenGL ES 3.0 - This API specification is supported by Android 4.3 (API level 18) and higher.</li>
<li>OpenGL ES 3.1 - This API specification is supported by Android 5.0 (API level 21) and higher.</li>
</ul>
</blockquote>
<p>API 8 开始可以使用Open GL ES2.0，现在的应用也一般都不在适配4.0一下的机器了，所以对于GL引擎的支持还是不错的。
这里为什么叫做ES ,ES是Embedded Syste的意思，是嵌入式系统的意思，专门针对一些设备做的。</p>
<h1></h1>
<h1>开始新建第一个Open GL项目</h1>
<h2>1.在mainfast中添加配置 GL ES版本</h2>
<pre><code>    # Open GL ES版本
    &lt;uses-feature android:glEsVersion=&quot;0x00020000&quot; android:required=&quot;true&quot; /&gt;
    
    # 纹理压缩的格式  这两种适配的机器比较多
    &lt;supports-gl-texture android:name=&quot;GL_OES_compressed_ETC1_RGB8_texture&quot; /&gt;
    &lt;supports-gl-texture android:name=&quot;GL_OES_compressed_paletted_texture&quot; /&gt;
    
</code></pre>
<pre><code>这里使用supports-gl-texture，每个 &lt;supports-gl-texture&gt; 元素只能声明一种所支持的纹理压缩格式， 这通过 android:name 属性值进行指定。 如果应用程序支持多种纹理压缩格式，可以声明多个 &lt;supports-gl-texture&gt; 元素。这个东西的声明决定了最终在一些机器的适配结果。
</code></pre>
<p>下面是每一种纹理格式的适配范围：</p>
<p>|   纹理压缩格式描述符          |	说明 |
|---|:---|:---:|
|  GL_OES_compressed_ETC1_RGB8_texture	| Ericsson 纹理压缩。在 OpenGL ES 2.0 中定义，适用于所有支持 OpenGL ES 2.0 的 Android 平台设备。
|   GL_OES_compressed_paletted_texture |	通用的带调色板的纹理压缩。
|   GL_AMD_compressed_3DC_texture|	ATI 3Dc 纹理压缩。
|   GL_AMD_compressed_ATC_texture| 	ATI 纹理压缩。适用于运行 Adreno GPU 的设备，包括 HTC Nexus One、Droid Incredible、EVO 等等。 为了保证最大的兼容性，设备还可以用 |   GL_ATI_texture_compression_atitc 描述符来声明 <supports-gl-texture> 元素。
|   GL_EXT_texture_compression_latc	| Luminance alpha 纹理压缩。
|   GL_EXT_texture_compression_dxt1 |	S3 DXT1 纹理压缩。适用于 Nvidia Tegra2 平台的设备，包括 Motorala Xoom、Motorola Atrix、Droid Bionic 等等。
|   GL_EXT_texture_compression_s3tc |	S3 纹理压缩，但不支持 DXT 变体。 适用于 Nvidia Tegra2 平台的设备，包括Motorala Xoom、Motorola Atrix、Droid Bionic 等等。 如果应用程序需要 DXT 变体，请换用上一条描述符进行声明。
|GL_IMG_texture_compression_pvrtc |	PowerVR 纹理压缩。 适用于带有 PowerVR SGX530/540 GPU 的设备，比如 Motorola DROID 系列；Samsung Galaxy S、Nexus S 和 Galaxy Tab 等等。</supports-gl-texture></p>
<h2>2.新建一个 GLSurfaceView 的子类</h2>
<pre><code>public class ContentGLSurfaceView extends GLSurfaceView {

    private final GLSurfaceView.Renderer mRenderer;

    public ContentGLSurfaceView(Context context){
        super(context);
        // 创建 OpenGL ES 2.0 context
        setEGLContextClientVersion(2);

        //mRenderer = new BackgroundGLRenderer();
        mRenderer = new TriangleGLRenderer();
        // 给GLSurfaceview设置一个渲染器
        setRenderer(mRenderer);
        //关闭 GL的循环绘制  只在onSurfaceChanged 之后或者 调用了requestRender()之后才发生绘制  减少多余的绘制的CPU消耗
        setRenderMode(GLSurfaceView.RENDERMODE_WHEN_DIRTY);
    }
}
</code></pre>
<h2>3.新建一个渲染器  (代码的解释都在注释里了)</h2>
<p>这里我写了两个渲染器，是学习时用的，第一个是绘制背景色的render，第二个这个这个类的子类，在背景色的基础上提供了三角形的绘制。</p>
<pre><code>public class BackgroundGLRenderer implements GLSurfaceView.Renderer {

    final long uColor=0xff55ffff; // #AARRGGBB format

    float fRed = (float)((uColor &gt;&gt; 16) &amp; 0xFF) / 0xFF;
    float fGreen = (float)((uColor &gt;&gt; 8) &amp; 0xFF) / 0xFF;
    float fBlue = (float)(uColor &amp; 0xFF) / 0xFF;
    float fAlpha = (float)(uColor &gt;&gt; 24) / 0xFF;


    //系统呼吁各重绘此方法GLSurfaceView。使用此方法作为主要执行点绘制（并重新绘制）图形对象。
    public void onDrawFrame(GL10 unused) {
        // 重绘背景色
        GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT);
    }

    /**
     * 在创建时，系统调用这个方法一次，GLSurfaceView。
     * 使用此方法来执行只需要发生一次的操作,如设置OpenGL的环境参数或初始化的OpenGL图形对象。
     * @param gl10
     * @param eglConfig
     */
    @Override
    public void onSurfaceCreated(GL10 gl10, EGLConfig eglConfig) {
        //使用刚刚我们预定义的背景色 每个参数的value  0-1
        GLES20.glClearColor(
                fRed,
                fGreen,
                fBlue,
                fAlpha);
    }

    //系统会调用这个方法的时候GLSurfaceView几何变化，包括尺寸变化GLSurfaceView或设备屏幕的方向
    // 。例如，当设备从纵向变为横向系统调用此方法。
    // 使用此方法可以在变化的响应GLSurfaceView容器。
    public void onSurfaceChanged(GL10 unused, int width, int height) {
        GLES20.glViewport(0, 0, width, height);
    }
}


/**
一个 三角形渲染器
**/
public class TriangleGLRenderer extends BackgroundGLRenderer implements GLSurfaceView.Renderer {

    private Triangle mTriangle;

    @Override
    public void onSurfaceCreated(GL10 gl10, EGLConfig eglConfig) {

        super.onSurfaceCreated(gl10,eglConfig);
        // 实例化这个三角形 triangle
        mTriangle = new Triangle();
    }

    @Override
    public void onSurfaceChanged(GL10 gl10, int i, int i1) {

        super.onSurfaceChanged(gl10,i,i1);
    }

    @Override
    public void onDrawFrame(GL10 gl10) {

        super.onDrawFrame(gl10);
        mTriangle.draw();
    }
}
</code></pre>
<h2>4.剩下的就是放到Activity中展示了</h2>
<pre><code>public class OpenGLES20Activity extends Activity {

    private GLSurfaceView mGLView;

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        // 把一个GLSurafaceView设置到 contentview上去
        mGLView = new ContentGLSurfaceView(this);
        setContentView(mGLView);
    }
}
</code></pre>
<h2>5.执行的最终效果</h2>
<p><img src="assets/opengl1.png" alt=""/></p>
<h2>过程中遇到的性能问题：</h2>
<p>绘制一个背景色，在乐视1手机上，CPU消耗在0-8 %不等，我用tracevie去抓取了2160ms,其中有360ms是cpu繁忙的，都是在绘制背景里面消耗的。</p>
<p>调试进去发现，页面其实已经绘制完成还在绘制，所以这里故意使用这句代码来关闭多余的绘制。</p>
<pre><code>setRenderMode(GLSurfaceView.RENDERMODE_WHEN_DIRTY);
</code></pre>
<p>然后性能解决了，今天也实现了一个简单的绘制背景色和三角形的代码。</p>
<h2>引用</h2>
<p>谷歌官方Open GL训练课程
<a href="https://developer.android.com/training/graphics/opengl/">https://developer.android.com/training/graphics/opengl/</a></p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"android 初次尝试Open GL","title":"android 初次尝试Open GL.md","mdsource":"md/android 初次尝试Open GL.md","date":" 2016/07/06 12:36:30","category":"几年后回看会觉得写的太烂"},"content":"title: android 初次尝试Open GL\ndate: 2016/07/06 12:36:30\nupdated: 2016/07/09 16:38:12\ncategories:\n- 技术\n---\n首先要考虑设备支持问题。如下是各个android 版本的支持：\nandroid 官方给的答案：\n\n\u003e- OpenGL ES 1.0 and 1.1 - This API specification is supported by Android 1.0 and higher.\n\u003e- OpenGL ES 2.0 - This API specification is supported by Android 2.2 (API level 8) and higher.\n\u003e- OpenGL ES 3.0 - This API specification is supported by Android 4.3 (API level 18) and higher.\n\u003e- OpenGL ES 3.1 - This API specification is supported by Android 5.0 (API level 21) and higher.\n\nAPI 8 开始可以使用Open GL ES2.0，现在的应用也一般都不在适配4.0一下的机器了，所以对于GL引擎的支持还是不错的。\n这里为什么叫做ES ,ES是Embedded Syste的意思，是嵌入式系统的意思，专门针对一些设备做的。\n\n\n# \n# 开始新建第一个Open GL项目\n\n## 1.在mainfast中添加配置 GL ES版本\n\n```\n    # Open GL ES版本\n    \u003cuses-feature android:glEsVersion=\"0x00020000\" android:required=\"true\" /\u003e\n    \n    # 纹理压缩的格式  这两种适配的机器比较多\n    \u003csupports-gl-texture android:name=\"GL_OES_compressed_ETC1_RGB8_texture\" /\u003e\n    \u003csupports-gl-texture android:name=\"GL_OES_compressed_paletted_texture\" /\u003e\n    \n```\n    这里使用supports-gl-texture，每个 \u003csupports-gl-texture\u003e 元素只能声明一种所支持的纹理压缩格式， 这通过 android:name 属性值进行指定。 如果应用程序支持多种纹理压缩格式，可以声明多个 \u003csupports-gl-texture\u003e 元素。这个东西的声明决定了最终在一些机器的适配结果。\n    \n下面是每一种纹理格式的适配范围：\n\n|   纹理压缩格式描述符          |\t说明 |\n|---|:---|:---:|\n|  GL_OES_compressed_ETC1_RGB8_texture\t| Ericsson 纹理压缩。在 OpenGL ES 2.0 中定义，适用于所有支持 OpenGL ES 2.0 的 Android 平台设备。\n|   GL_OES_compressed_paletted_texture |\t通用的带调色板的纹理压缩。\n|   GL_AMD_compressed_3DC_texture|\tATI 3Dc 纹理压缩。\n|   GL_AMD_compressed_ATC_texture| \tATI 纹理压缩。适用于运行 Adreno GPU 的设备，包括 HTC Nexus One、Droid Incredible、EVO 等等。 为了保证最大的兼容性，设备还可以用 |   GL_ATI_texture_compression_atitc 描述符来声明 \u003csupports-gl-texture\u003e 元素。\n|   GL_EXT_texture_compression_latc\t| Luminance alpha 纹理压缩。\n|   GL_EXT_texture_compression_dxt1 |\tS3 DXT1 纹理压缩。适用于 Nvidia Tegra2 平台的设备，包括 Motorala Xoom、Motorola Atrix、Droid Bionic 等等。\n|   GL_EXT_texture_compression_s3tc |\tS3 纹理压缩，但不支持 DXT 变体。 适用于 Nvidia Tegra2 平台的设备，包括Motorala Xoom、Motorola Atrix、Droid Bionic 等等。 如果应用程序需要 DXT 变体，请换用上一条描述符进行声明。\n|GL_IMG_texture_compression_pvrtc |\tPowerVR 纹理压缩。 适用于带有 PowerVR SGX530/540 GPU 的设备，比如 Motorola DROID 系列；Samsung Galaxy S、Nexus S 和 Galaxy Tab 等等。\n\n\n## 2.新建一个 GLSurfaceView 的子类\n```\npublic class ContentGLSurfaceView extends GLSurfaceView {\n\n    private final GLSurfaceView.Renderer mRenderer;\n\n    public ContentGLSurfaceView(Context context){\n        super(context);\n        // 创建 OpenGL ES 2.0 context\n        setEGLContextClientVersion(2);\n\n        //mRenderer = new BackgroundGLRenderer();\n        mRenderer = new TriangleGLRenderer();\n        // 给GLSurfaceview设置一个渲染器\n        setRenderer(mRenderer);\n        //关闭 GL的循环绘制  只在onSurfaceChanged 之后或者 调用了requestRender()之后才发生绘制  减少多余的绘制的CPU消耗\n        setRenderMode(GLSurfaceView.RENDERMODE_WHEN_DIRTY);\n    }\n}\n```\n\n## 3.新建一个渲染器  (代码的解释都在注释里了)\n这里我写了两个渲染器，是学习时用的，第一个是绘制背景色的render，第二个这个这个类的子类，在背景色的基础上提供了三角形的绘制。\n```\npublic class BackgroundGLRenderer implements GLSurfaceView.Renderer {\n\n    final long uColor=0xff55ffff; // #AARRGGBB format\n\n    float fRed = (float)((uColor \u003e\u003e 16) \u0026 0xFF) / 0xFF;\n    float fGreen = (float)((uColor \u003e\u003e 8) \u0026 0xFF) / 0xFF;\n    float fBlue = (float)(uColor \u0026 0xFF) / 0xFF;\n    float fAlpha = (float)(uColor \u003e\u003e 24) / 0xFF;\n\n\n    //系统呼吁各重绘此方法GLSurfaceView。使用此方法作为主要执行点绘制（并重新绘制）图形对象。\n    public void onDrawFrame(GL10 unused) {\n        // 重绘背景色\n        GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT);\n    }\n\n    /**\n     * 在创建时，系统调用这个方法一次，GLSurfaceView。\n     * 使用此方法来执行只需要发生一次的操作,如设置OpenGL的环境参数或初始化的OpenGL图形对象。\n     * @param gl10\n     * @param eglConfig\n     */\n    @Override\n    public void onSurfaceCreated(GL10 gl10, EGLConfig eglConfig) {\n        //使用刚刚我们预定义的背景色 每个参数的value  0-1\n        GLES20.glClearColor(\n                fRed,\n                fGreen,\n                fBlue,\n                fAlpha);\n    }\n\n    //系统会调用这个方法的时候GLSurfaceView几何变化，包括尺寸变化GLSurfaceView或设备屏幕的方向\n    // 。例如，当设备从纵向变为横向系统调用此方法。\n    // 使用此方法可以在变化的响应GLSurfaceView容器。\n    public void onSurfaceChanged(GL10 unused, int width, int height) {\n        GLES20.glViewport(0, 0, width, height);\n    }\n}\n\n\n/**\n一个 三角形渲染器\n**/\npublic class TriangleGLRenderer extends BackgroundGLRenderer implements GLSurfaceView.Renderer {\n\n    private Triangle mTriangle;\n\n    @Override\n    public void onSurfaceCreated(GL10 gl10, EGLConfig eglConfig) {\n\n        super.onSurfaceCreated(gl10,eglConfig);\n        // 实例化这个三角形 triangle\n        mTriangle = new Triangle();\n    }\n\n    @Override\n    public void onSurfaceChanged(GL10 gl10, int i, int i1) {\n\n        super.onSurfaceChanged(gl10,i,i1);\n    }\n\n    @Override\n    public void onDrawFrame(GL10 gl10) {\n\n        super.onDrawFrame(gl10);\n        mTriangle.draw();\n    }\n}\n```\n## 4.剩下的就是放到Activity中展示了\n```\npublic class OpenGLES20Activity extends Activity {\n\n    private GLSurfaceView mGLView;\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        // 把一个GLSurafaceView设置到 contentview上去\n        mGLView = new ContentGLSurfaceView(this);\n        setContentView(mGLView);\n    }\n}\n```\n\n## 5.执行的最终效果\n![](assets/opengl1.png)\n\n\n##  过程中遇到的性能问题：\n绘制一个背景色，在乐视1手机上，CPU消耗在0-8 %不等，我用tracevie去抓取了2160ms,其中有360ms是cpu繁忙的，都是在绘制背景里面消耗的。\n\n调试进去发现，页面其实已经绘制完成还在绘制，所以这里故意使用这句代码来关闭多余的绘制。\n```\nsetRenderMode(GLSurfaceView.RENDERMODE_WHEN_DIRTY);\n```\n然后性能解决了，今天也实现了一个简单的绘制背景色和三角形的代码。\n\n##  引用\n谷歌官方Open GL训练课程\nhttps://developer.android.com/training/graphics/opengl/\n\n\n\n","lang":"cn"},"__N_SSG":true},"page":"/[lang]/blog/[slug]","query":{"lang":"cn","slug":"android 初次尝试Open GL"},"buildId":"lw2IExpT7GBLnCqajAO6w","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>