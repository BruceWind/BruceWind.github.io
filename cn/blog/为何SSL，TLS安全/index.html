<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><meta name="emotion-insertion-point" content=""/><title>为何SSL，TLS安全.md<!-- --> - BruceWind&#x27;s Blog</title><meta name="description" content="为何SSL，TLS安全.md - 几年后回看会觉得写的太烂"/><meta property="og:title" content="为何SSL，TLS安全.md"/><meta property="og:type" content="article"/><meta property="article:published_time" content=" 2020/02/04 22:38:08"/><meta name="next-head-count" content="8"/><meta charSet="utf-8"/><meta name="keywords" content="NDK,JNI,Android Dev,android,androidyuan,性能优化,Linux,developer"/><meta name="description" content="BruceWind&#x27;s personal blog - Android development, Linux, and more."/><meta name="robots" content="index,follow"/><meta name="google" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="author" content="bruce"/><link rel="icon" href="/favicon.ico"/><meta name="theme-color" content="#000000"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LGE1LT9YJG"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-LGE1LT9YJG');
              </script><style data-emotion="mui-style-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-style 17ro72p 1cp6o32 79elbk 1qo0fs4 1uf4bbi 1m9pwf3 19gndve 1ju1kxc k1u9gz 6xugel vubbuv gtvj52 1x1vlev vax71z">.mui-style-17ro72p{width:100%;min-height:100vh;background-color:#fff;padding:16px;}.mui-style-1cp6o32{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12);padding:24px;}.mui-style-79elbk{position:relative;}.mui-style-1qo0fs4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;width:58px;height:38px;overflow:hidden;padding:12px;box-sizing:border-box;position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;z-index:0;vertical-align:middle;width:62px;height:34px;padding:7px;margin:8px;}@media print{.mui-style-1qo0fs4{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1qo0fs4 .MuiSwitch-switchBase{margin:1px;padding:0;-webkit-transform:translateX(6px);-moz-transform:translateX(6px);-ms-transform:translateX(6px);transform:translateX(6px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked{color:#fff;-webkit-transform:translateX(22px);-moz-transform:translateX(22px);-ms-transform:translateX(22px);transform:translateX(22px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked .MuiSwitch-thumb:before{background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><path d="M0 0h24v24H0z" fill="none"/><path fill="white" d="M12 19a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5.5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm11 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13 2v2h6v2h-1.968a18.222 18.222 0 0 1-3.621 6.302 14.685 14.685 0 0 0 5.327 3.042l-.536 1.93A16.685 16.685 0 0 1 12 13.726a16.696 16.696 0 0 1-6.202 3.547l-.536-1.929a14.7 14.7 0 0 0 5.327-3.042 18.077 18.077 0 0 1-2.822-4.3h2.24A16.031 16.031 0 0 0 12 10.876a16.168 16.168 0 0 0 2.91-4.876L5 6V4h6V2h2z"/></g></svg>');}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked+.MuiSwitch-track{opacity:1;background-color:#aab4be;}.mui-style-1qo0fs4 .MuiSwitch-thumb{background-color:#001e3c;width:32px;height:32px;}.mui-style-1qo0fs4 .MuiSwitch-thumb:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none" /><path fill="white" d="M14 10h2v.757a4.5 4.5 0 0 1 7 3.743V20h-2v-5.5c0-1.43-1.175-2.5-2.5-2.5S16 13.07 16 14.5V20h-2V10zm-2-6v2H4v5h8v2H4v5h8v2H2V4h10z"/></svg>');}.mui-style-1qo0fs4 .MuiSwitch-track{opacity:1;background-color:#aab4be;border-radius:10px;}.mui-style-1uf4bbi{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;padding:9px;border-radius:50%;position:absolute;top:0;left:0;z-index:1;color:#fff;-webkit-transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,-webkit-transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.mui-style-1uf4bbi::-moz-focus-inner{border-style:none;}.mui-style-1uf4bbi.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-1uf4bbi{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1uf4bbi.Mui-checked{-webkit-transform:translateX(20px);-moz-transform:translateX(20px);-ms-transform:translateX(20px);transform:translateX(20px);}.mui-style-1uf4bbi.Mui-disabled{color:#f5f5f5;}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{opacity:0.5;}.mui-style-1uf4bbi.Mui-disabled+.MuiSwitch-track{opacity:0.12;}.mui-style-1uf4bbi .MuiSwitch-input{left:-100%;width:300%;}.mui-style-1uf4bbi:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.mui-style-1uf4bbi:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked{color:#1976d2;}.mui-style-1uf4bbi.Mui-checked:hover{background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-1uf4bbi.Mui-checked:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked.Mui-disabled{color:rgb(167, 202, 237);}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{background-color:#1976d2;}.mui-style-1m9pwf3{cursor:inherit;position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;margin:0;padding:0;z-index:1;}.mui-style-19gndve{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);background-color:currentColor;width:20px;height:20px;border-radius:50%;}.mui-style-1ju1kxc{height:100%;width:100%;border-radius:7px;z-index:-1;-webkit-transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;background-color:#000;opacity:0.38;}.mui-style-k1u9gz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;margin-bottom:16px;}.mui-style-k1u9gz::-moz-focus-inner{border-style:none;}.mui-style-k1u9gz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-k1u9gz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-k1u9gz:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-k1u9gz:hover{background-color:transparent;}}.mui-style-k1u9gz.Mui-disabled{color:rgba(0, 0, 0, 0.26);}.mui-style-6xugel{display:inherit;margin-right:8px;margin-left:-4px;}.mui-style-6xugel>*:nth-of-type(1){font-size:20px;}.mui-style-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.mui-style-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}.mui-style-1x1vlev{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;margin-bottom:0.35em;color:rgba(0, 0, 0, 0.6);}.mui-style-vax71z{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;margin-top:16px;margin-bottom:16px;}</style><link rel="preload" href="/_next/static/css/345ff263c1768dbb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/345ff263c1768dbb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-5b2299ded1a46c83.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4f0aaa3a6ba99024.js" defer=""></script><script src="/_next/static/chunks/34-75ae01f5fa578a9a.js" defer=""></script><script src="/_next/static/chunks/995-a5f98cc3a4d14286.js" defer=""></script><script src="/_next/static/chunks/771-702e6dcd51d5534b.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blang%5D/blog/%5Bslug%5D-beca72dadde25cc7.js" defer=""></script><script src="/_next/static/GHV3Hdifg6RQFG6pfrsvS/_buildManifest.js" defer=""></script><script src="/_next/static/GHV3Hdifg6RQFG6pfrsvS/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="MuiBox-root mui-style-17ro72p"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation3 mui-style-1cp6o32"><div class="MuiBox-root mui-style-79elbk"><div style="position:fixed;top:22px;right:15px;z-index:1300"><span class="MuiSwitch-root MuiSwitch-sizeMedium mui-style-1qo0fs4"><span class="MuiButtonBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked PrivateSwitchBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked Mui-checked mui-style-1uf4bbi"><input class="PrivateSwitchBase-input MuiSwitch-input mui-style-1m9pwf3" type="checkbox" checked=""/><span class="MuiSwitch-thumb mui-style-19gndve"></span></span><span class="MuiSwitch-track mui-style-1ju1kxc"></span></span></div><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary mui-style-k1u9gz" tabindex="0" href="/cn/"><span class="MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium mui-style-6xugel"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium mui-style-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"></path></svg></span>返回列表</a><h1 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom mui-style-gtvj52">为何SSL，TLS安全.md</h1><p class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom mui-style-1x1vlev">几年后回看会觉得写的太烂<!-- --> | <!-- --> 2020/02/04 22:38:08</p><hr class="MuiDivider-root MuiDivider-fullWidth mui-style-vax71z"/><div class="markdown-body"><p>title: 为何SSL&amp;TLS如何工作的,为何安全？
date: 2020-01-17 19:18:39</p>
<hr/>
<h1>SSL/TLS</h1>
<p>先跳过如何工作的这个话题，从逆向攻击的角度去理解他的设计。如果从正方向讲这个逻辑,反而很难理解为啥安全.</p>
<h3>SSL工作流程为何安全？</h3>
<p>Q:SSL工作流程为何安全？
A:因为他是对称加密传输，所以安全且性能好。</p>
<p>Q:但是，对称加密的<code>skey</code>(symmetric key)怎么存，好像你怎么存都不能做到安全？
A:没有存储，建立连接时随机生成，并传给服务端。</p>
<p>Q:那生成好了传输不是会被抓到吗？
A:不会，因为<strong>skey的字符串用非对称加密传输</strong>：server先下发包含<code>pub key</code>的证书，browser使用<code>pub key</code>加密生成好的skey发给server，server再用私钥解密，因为私钥没有泄漏，所以没人能从中间解密。即使中间人抓到了<code>pub key</code>， 但是没有人能拿到对称加密过程的skey。</p>
<p>Q:这样子看上是去比较安全，那<strong>如果中间人替换了证书</strong>？
A：browser会做证书链校验。server给的是一个证书链，需要从根证书开始层层校验。<a href="https://myssl.com/www.baidu.com?domain=www.baidu.com&amp;port=443">查看百度配置的证书详细信息，内含证书链</a></p>
<p>baidu.com证书链如下:</p>
<pre><code class="language-mermaid">graph LR
A(GlobalSign Root CA) -- verify --&gt; B(GlobalSign Organization Validation CA)
B -- verify --&gt; C(baidu.com)
</code></pre>
<p>Q:证书链校验过程是什么？</p>
<blockquote>
<ul>
<li>A:跳过<strong>过期</strong>，<strong>被吊销</strong>的检查，只谈通过算法验证证书真实性：</li>
<li>
<ul>
<li>证书文件生成时会<strong>追加</strong>一个数字签名，你可以搜一下生成证书的流程，都是需要签名的。这个用于生成签名<code>私钥</code>来自上级证书。既然验证时需要向上追溯，肯定不能无限追溯，总要有个底，对的，的确有个根证书。验证证书链时，就是从根证书一级级地上向校验,根证书存在于浏览器或者操作系统中了。</li>
</ul>
</li>
</ul>
</blockquote>
<p>Q:怎么校验单个证书的签名？
A:签名生成过程：<code>原文--原文的哈希--私钥加密---签名</code>，
校验签名过程:<code>签名---公钥解密得到哈希----对原文进行哈希--比对两个哈希</code>。哈希值相同，则证明明文的发送者，是私钥的持有者。这个模式的设计要归功与<code>非对称加密算法</code>的发明。</p>
<p>Q: 那根证书如何信任？听上去感觉这个是整个验证的前提。
A:对，这个是一切验证的前提。这个是必须要信任的东西，在系统，或者浏览器被安装时已经存在了，<strong>你只能相信系统</strong>。</p>
<p>如上，看了这么多攻击角度的理解，你看下面，从头理一下他的流程。</p>
<h3>SSL/TLS如何工作？</h3>
<p>举例HTTPS工作流程里的SSL示例：</p>
<blockquote>
<ul>
<li>1.你的browser发起请求，从server要一个证书。</li>
<li>2.server给你一个证书，它包含很多信息，其中有public key，他也会告诉你上级证书是谁，可以得到一个证书链。</li>
<li>3.browser会从根证书一层层校验，确认证书不是伪造的。</li>
<li>4.不是伪造之后，browser生成一个用于对称加密的skey，用于后面的传输过程的<code>对称加密</code>，所以server也需要知道这个skey，就拿刚刚信赖的证书的<code>pub key</code>加密skey，传给server，server用<code>pri key</code>解开这个数据，取得skey。</li>
<li>5.前面一步，两边已经都得到一个共用的skey了，之后数据传输就都是用skey对数据做对称加密即可，对称加密的概念不再赘述。</li>
</ul>
</blockquote>
<h3>SSH呢？</h3>
<p>大体上跟https这个证书类似，大体的逻辑还是先校验对方身份，然后生成skey，再用非对称加密传递<code>skey</code>，另外一方用非对称加密解开skey，后面通信就会用<code>skey</code>做对称加解密，至于为什么用对称加密，因为对称加密性能好嘛。第一步<code>校验</code>很重要，防止中间人欺骗你。
再说其他细节就还有ssh协议标准是否一致的校验。</p>
<p>自己有服务器的同学都知道，SSH有两种登录方式，第一种是账户密码，这个叫做<strong>口令登录</strong>，第二种是<strong>密钥登录</strong>。
1.<strong>口令登录</strong>：SSH程序无法确保该服务器是否是个假的，是否为中间人，他会提供一个指纹给你，让你确认对方是否可信，可信之后后面就不再赘述了，跟上面类似。
这里你肯定要问，我如何确认我的服务器指纹?其实你创建一个服务器，第一次启动ssh服务时，会生成好一套key，如果你买的虚拟服务器，可能从panel那边查到指纹，或者提供给你的webshell里手动查询一下。实际上，特么大多数云计算平台不提供主机密钥指纹。</p>
<p>2.<strong>密钥登录</strong>，是你把你的pub key 丢给server。利用非对称加密的安全性，这个其实比你用口令登录更安全，但是一样需要校验服务器ssh的指纹,细节逻辑同上了不再赘述了。</p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"为何SSL，TLS安全","title":"为何SSL，TLS安全.md","mdsource":"md/为何SSL，TLS安全.md","date":" 2020/02/04 22:38:08","category":"几年后回看会觉得写的太烂"},"content":"title: 为何SSL\u0026TLS如何工作的,为何安全？\ndate: 2020-01-17 19:18:39\n\n------------------\n\n# SSL/TLS\n\n先跳过如何工作的这个话题，从逆向攻击的角度去理解他的设计。如果从正方向讲这个逻辑,反而很难理解为啥安全.\n\n### SSL工作流程为何安全？\nQ:SSL工作流程为何安全？\nA:因为他是对称加密传输，所以安全且性能好。\n\nQ:但是，对称加密的`skey`(symmetric key)怎么存，好像你怎么存都不能做到安全？\nA:没有存储，建立连接时随机生成，并传给服务端。\n\nQ:那生成好了传输不是会被抓到吗？\nA:不会，因为**skey的字符串用非对称加密传输**：server先下发包含`pub key`的证书，browser使用`pub key`加密生成好的skey发给server，server再用私钥解密，因为私钥没有泄漏，所以没人能从中间解密。即使中间人抓到了`pub key`， 但是没有人能拿到对称加密过程的skey。\n\nQ:这样子看上是去比较安全，那**如果中间人替换了证书**？\nA：browser会做证书链校验。server给的是一个证书链，需要从根证书开始层层校验。[查看百度配置的证书详细信息，内含证书链](https://myssl.com/www.baidu.com?domain=www.baidu.com\u0026port=443)\n\nbaidu.com证书链如下:\n```mermaid\ngraph LR\nA(GlobalSign Root CA) -- verify --\u003e B(GlobalSign Organization Validation CA)\nB -- verify --\u003e C(baidu.com)\n```\n\nQ:证书链校验过程是什么？\n\u003e - A:跳过**过期**，**被吊销**的检查，只谈通过算法验证证书真实性：\n\u003e - - 证书文件生成时会**追加**一个数字签名，你可以搜一下生成证书的流程，都是需要签名的。这个用于生成签名`私钥`来自上级证书。既然验证时需要向上追溯，肯定不能无限追溯，总要有个底，对的，的确有个根证书。验证证书链时，就是从根证书一级级地上向校验,根证书存在于浏览器或者操作系统中了。\n\nQ:怎么校验单个证书的签名？\nA:签名生成过程：`原文--原文的哈希--私钥加密---签名`，\n校验签名过程:`签名---公钥解密得到哈希----对原文进行哈希--比对两个哈希`。哈希值相同，则证明明文的发送者，是私钥的持有者。这个模式的设计要归功与`非对称加密算法`的发明。\n\nQ: 那根证书如何信任？听上去感觉这个是整个验证的前提。\nA:对，这个是一切验证的前提。这个是必须要信任的东西，在系统，或者浏览器被安装时已经存在了，**你只能相信系统**。\n\n\n如上，看了这么多攻击角度的理解，你看下面，从头理一下他的流程。\n\n### SSL/TLS如何工作？\n举例HTTPS工作流程里的SSL示例：\n\u003e - 1.你的browser发起请求，从server要一个证书。\n\u003e - 2.server给你一个证书，它包含很多信息，其中有public key，他也会告诉你上级证书是谁，可以得到一个证书链。\n\u003e - 3.browser会从根证书一层层校验，确认证书不是伪造的。\n\u003e - 4.不是伪造之后，browser生成一个用于对称加密的skey，用于后面的传输过程的`对称加密`，所以server也需要知道这个skey，就拿刚刚信赖的证书的`pub key`加密skey，传给server，server用`pri key`解开这个数据，取得skey。\n\u003e - 5.前面一步，两边已经都得到一个共用的skey了，之后数据传输就都是用skey对数据做对称加密即可，对称加密的概念不再赘述。\n\n\n### SSH呢？\n大体上跟https这个证书类似，大体的逻辑还是先校验对方身份，然后生成skey，再用非对称加密传递`skey`，另外一方用非对称加密解开skey，后面通信就会用`skey`做对称加解密，至于为什么用对称加密，因为对称加密性能好嘛。第一步`校验`很重要，防止中间人欺骗你。\n再说其他细节就还有ssh协议标准是否一致的校验。\n\n自己有服务器的同学都知道，SSH有两种登录方式，第一种是账户密码，这个叫做**口令登录**，第二种是**密钥登录**。\n1.**口令登录**：SSH程序无法确保该服务器是否是个假的，是否为中间人，他会提供一个指纹给你，让你确认对方是否可信，可信之后后面就不再赘述了，跟上面类似。\n这里你肯定要问，我如何确认我的服务器指纹?其实你创建一个服务器，第一次启动ssh服务时，会生成好一套key，如果你买的虚拟服务器，可能从panel那边查到指纹，或者提供给你的webshell里手动查询一下。实际上，特么大多数云计算平台不提供主机密钥指纹。\n\n2.**密钥登录**，是你把你的pub key 丢给server。利用非对称加密的安全性，这个其实比你用口令登录更安全，但是一样需要校验服务器ssh的指纹,细节逻辑同上了不再赘述了。\n","lang":"cn"},"__N_SSG":true},"page":"/[lang]/blog/[slug]","query":{"lang":"cn","slug":"为何SSL，TLS安全"},"buildId":"GHV3Hdifg6RQFG6pfrsvS","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>