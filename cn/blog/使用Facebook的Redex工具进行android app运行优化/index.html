<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><meta name="emotion-insertion-point" content=""/><title>使用Facebook的Redex工具进行android app运行优化.md<!-- --> - BruceWind&#x27;s Blog</title><meta name="description" content="使用Facebook的Redex工具进行android app运行优化.md - 几年后回看会觉得写的太烂"/><meta property="og:title" content="使用Facebook的Redex工具进行android app运行优化.md"/><meta property="og:type" content="article"/><meta property="article:published_time" content=" 2016/04/15 10:04:47"/><meta name="next-head-count" content="8"/><meta charSet="utf-8"/><meta name="keywords" content="NDK,JNI,Android Dev,android,androidyuan,性能优化,Linux,developer"/><meta name="description" content="BruceWind&#x27;s personal blog - Android development, Linux, and more."/><meta name="robots" content="index,follow"/><meta name="google" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="author" content="bruce"/><link rel="icon" href="/favicon.ico"/><meta name="theme-color" content="#000000"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LGE1LT9YJG"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-LGE1LT9YJG');
              </script><style data-emotion="mui-style-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-style 17ro72p 1cp6o32 79elbk 1qo0fs4 1uf4bbi 1m9pwf3 19gndve 1ju1kxc k1u9gz 6xugel 1k33q06 gtvj52 1x1vlev vax71z">.mui-style-17ro72p{width:100%;min-height:100vh;background-color:#fff;padding:16px;}.mui-style-1cp6o32{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12);padding:24px;}.mui-style-79elbk{position:relative;}.mui-style-1qo0fs4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;width:58px;height:38px;overflow:hidden;padding:12px;box-sizing:border-box;position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;z-index:0;vertical-align:middle;width:62px;height:34px;padding:7px;margin:8px;}@media print{.mui-style-1qo0fs4{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1qo0fs4 .MuiSwitch-switchBase{margin:1px;padding:0;-webkit-transform:translateX(6px);-moz-transform:translateX(6px);-ms-transform:translateX(6px);transform:translateX(6px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked{color:#fff;-webkit-transform:translateX(22px);-moz-transform:translateX(22px);-ms-transform:translateX(22px);transform:translateX(22px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked .MuiSwitch-thumb:before{background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><path d="M0 0h24v24H0z" fill="none"/><path fill="white" d="M12 19a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5.5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm11 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13 2v2h6v2h-1.968a18.222 18.222 0 0 1-3.621 6.302 14.685 14.685 0 0 0 5.327 3.042l-.536 1.93A16.685 16.685 0 0 1 12 13.726a16.696 16.696 0 0 1-6.202 3.547l-.536-1.929a14.7 14.7 0 0 0 5.327-3.042 18.077 18.077 0 0 1-2.822-4.3h2.24A16.031 16.031 0 0 0 12 10.876a16.168 16.168 0 0 0 2.91-4.876L5 6V4h6V2h2z"/></g></svg>');}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked+.MuiSwitch-track{opacity:1;background-color:#aab4be;}.mui-style-1qo0fs4 .MuiSwitch-thumb{background-color:#001e3c;width:32px;height:32px;}.mui-style-1qo0fs4 .MuiSwitch-thumb:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none" /><path fill="white" d="M14 10h2v.757a4.5 4.5 0 0 1 7 3.743V20h-2v-5.5c0-1.43-1.175-2.5-2.5-2.5S16 13.07 16 14.5V20h-2V10zm-2-6v2H4v5h8v2H4v5h8v2H2V4h10z"/></svg>');}.mui-style-1qo0fs4 .MuiSwitch-track{opacity:1;background-color:#aab4be;border-radius:10px;}.mui-style-1uf4bbi{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;padding:9px;border-radius:50%;position:absolute;top:0;left:0;z-index:1;color:#fff;-webkit-transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,-webkit-transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.mui-style-1uf4bbi::-moz-focus-inner{border-style:none;}.mui-style-1uf4bbi.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-1uf4bbi{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1uf4bbi.Mui-checked{-webkit-transform:translateX(20px);-moz-transform:translateX(20px);-ms-transform:translateX(20px);transform:translateX(20px);}.mui-style-1uf4bbi.Mui-disabled{color:#f5f5f5;}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{opacity:0.5;}.mui-style-1uf4bbi.Mui-disabled+.MuiSwitch-track{opacity:0.12;}.mui-style-1uf4bbi .MuiSwitch-input{left:-100%;width:300%;}.mui-style-1uf4bbi:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.mui-style-1uf4bbi:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked{color:#1976d2;}.mui-style-1uf4bbi.Mui-checked:hover{background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-1uf4bbi.Mui-checked:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked.Mui-disabled{color:rgb(167, 202, 237);}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{background-color:#1976d2;}.mui-style-1m9pwf3{cursor:inherit;position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;margin:0;padding:0;z-index:1;}.mui-style-19gndve{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);background-color:currentColor;width:20px;height:20px;border-radius:50%;}.mui-style-1ju1kxc{height:100%;width:100%;border-radius:7px;z-index:-1;-webkit-transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;background-color:#000;opacity:0.38;}.mui-style-k1u9gz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;margin-bottom:16px;}.mui-style-k1u9gz::-moz-focus-inner{border-style:none;}.mui-style-k1u9gz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-k1u9gz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-k1u9gz:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-k1u9gz:hover{background-color:transparent;}}.mui-style-k1u9gz.Mui-disabled{color:rgba(0, 0, 0, 0.26);}.mui-style-6xugel{display:inherit;margin-right:8px;margin-left:-4px;}.mui-style-6xugel>*:nth-of-type(1){font-size:20px;}.mui-style-1k33q06{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.25rem;}.mui-style-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}.mui-style-1x1vlev{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;margin-bottom:0.35em;color:rgba(0, 0, 0, 0.6);}.mui-style-vax71z{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;margin-top:16px;margin-bottom:16px;}</style><link rel="preload" href="/_next/static/css/345ff263c1768dbb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/345ff263c1768dbb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-5b2299ded1a46c83.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4f0aaa3a6ba99024.js" defer=""></script><script src="/_next/static/chunks/34-75ae01f5fa578a9a.js" defer=""></script><script src="/_next/static/chunks/995-a5f98cc3a4d14286.js" defer=""></script><script src="/_next/static/chunks/771-702e6dcd51d5534b.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blang%5D/blog/%5Bslug%5D-c0566a06cafc2ea3.js" defer=""></script><script src="/_next/static/zaycUZ6jvMLykcBwRP9wT/_buildManifest.js" defer=""></script><script src="/_next/static/zaycUZ6jvMLykcBwRP9wT/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="MuiBox-root mui-style-17ro72p"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation3 mui-style-1cp6o32"><div class="MuiBox-root mui-style-79elbk"><div style="position:fixed;top:22px;right:15px;z-index:1300"><span class="MuiSwitch-root MuiSwitch-sizeMedium mui-style-1qo0fs4"><span class="MuiButtonBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked PrivateSwitchBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked Mui-checked mui-style-1uf4bbi"><input class="PrivateSwitchBase-input MuiSwitch-input mui-style-1m9pwf3" type="checkbox" checked=""/><span class="MuiSwitch-thumb mui-style-19gndve"></span></span><span class="MuiSwitch-track mui-style-1ju1kxc"></span></span></div><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary mui-style-k1u9gz" tabindex="0" href="/cn/"><span class="MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium mui-style-6xugel"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall mui-style-1k33q06" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"></path></svg></span>返回列表</a><h1 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom mui-style-gtvj52">使用Facebook的Redex工具进行android app运行优化.md</h1><p class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom mui-style-1x1vlev">几年后回看会觉得写的太烂<!-- --> | <!-- --> 2016/04/15 10:04:47</p><hr class="MuiDivider-root MuiDivider-fullWidth mui-style-vax71z"/><div class="markdown-body"><p>title: 使用Facebook的Redex工具进行android app运行优化
date: 2016/04/15 10:04:47
updated: 2016/04/29 21:21:17
categories:</p>
<ul>
<li>技术</li>
</ul>
<hr/>
<p><img src="assets/fb_logo.jpg" alt=""/></p>
<pre><code>抱歉：我又盗了别人家的图,从网上偷了一个facebook的logo。哈哈哈！！！！好了回到正题。

去年，Facebook使用叫ReDex的字节码优化工具优化了他们的安卓应用的性能.

昨天收到消息，ReDex已经重新发布了。安卓开发者可以免费地使用这个工具优化自己的应用。也可以将它用作其它安卓字节码优化工具的基础。

在Facebook工程博客的一篇文章中指出，`dex`并不是按照应用启动时候加载的顺序加载的，而是按照编译工具指定的顺序加载的。

ReDex使程序运行时产生的运行数据判定哪些类应该在.DEX文件中被优先载入。“想要最小化从内存中读取数据的次数，最好从启动的时候就载入字节码。”Facebook称，他们使用ReDex对应用优化之后，对存储的读取减少了25%，运行速度提高了30%。
关于这个速度，Facebook称，在存储较慢的老旧机器上效果非常明显，但是对于新的收集，性能也有明显的提高。

Facebook在一台搭载了安卓4.4的全新的Nexus4上（有35%的安卓设备运行这个版本）测试，启动时间从2秒降至1.6秒。

Runtime分析可以用来删除无关的元数据和接口，但是开发者也可以自定义优化的行为。比如，有些方法即使没有直接被调用，也可以让它们保留下来。

这个优化是在应用编译完成之后进行的。也就是说，理论上你也可以结合其他优化，比如对Java进行虚拟机层的优化和语言的优化，像即将到来的Java 9的语言模块特性等等。
优化Java的字节码文件并不是一种新技术。还有其他的开源项目，例如ProGuard就可以通过删除运行时没有使用的代码进行优化。但是它并不能像ReDex那样按照执行顺序来重新组织类。
</code></pre>
<p>这里值得一提的是redex这个项目，虽然facebook玩了一年了，但是github上这个项目第一次commit的日期是<code>Commits on Apr 7, 2016</code>。
不是这帮技术宅一直没开源出来，而是他们最早它是挂在<a href="https://github.com/facebook/folly">folly这个项目</a>下面的。</p>
<hr/>
<p>----------- 我是一个可爱的分割线 (⊙_⊙;)---------------</p>
<hr/>
<pre><code>由于只是开放源代码，但是没有提出来做成一个软件给我们用，但是我是linux，我可以就直接下载代码make install就可以运行redex了。
</code></pre>
<h2>下面是我所遇到的所有问题</h2>
<h1></h1>
<p>安装过程在<a href="https://github.com/facebook/redex">facebook的github</a>上已经写的很清楚，但是linux总是各种问题你懂得，等着你去解决它。</p>
<h2>报错： autoreconf: &#x27;configure.ac&#x27; or &#x27;configure.in&#x27; is required的解决</h2>
<p>于是从Git上找到了这个：
Download and install double-conversion:</p>
<pre><code>  git clone https://github.com/google/double-conversion.git
  cd double-conversion
  cmake -DBUILD_SHARED_LIBS=ON .
  make
  sudo make install
</code></pre>
<p>之后再执行　   <code>autoreconf -ivf</code></p>
<h2>报错：error: possibly undefined macro: AM_PROG_LIBTOOL       If this token and others are legitimate, please use m4_pattern_allow的解决</h2>
<h1></h1>
<p>然后又从stackoverflow上找到了这个：
<a href="http://superuser.com/questions/653172/how-do-i-resolve-an-error-about-am-prog-libtool-when-building-libopus-from-git/653173">How do I resolve an error about AM_PROG_LIBTOOL when building libopus from git?</a></p>
<h1></h1>
<p>我<code>install libtool</code>之后，终于不在报错</p>
<pre><code class="language-xml">...
...
parallel-tests: installing &#x27;build-aux/test-driver&#x27;
autoreconf: Leaving directory `.&#x27;
</code></pre>
<h1></h1>
<p>继续执行：</p>
<pre><code class="language-shell">
//然后又是巴拉巴拉一堆log：
...
...
...
checking if g++ supports C++0x features without additional flags... no
checking if g++ supports C++0x features with -std=c++0x... yes
checking if g++ supports C++0x features with -std=gnu++0x... yes
checking for main in -lgflags... no
configure: error: Please install google-gflags library

</code></pre>
<h1></h1>
<h2>报错：Please install google-gflags library的解决</h2>
<h1></h1>
<p>这个问题在github上这个仓库的issues中也有提到：
<a href="https://github.com/facebook/folly/issues/117">https://github.com/facebook/folly/issues/117</a>
但是这个issues并没有什么卵用：
最后还是找了这个：
<a href="http://caffe.berkeleyvision.org/install_apt.html">http://caffe.berkeleyvision.org/install_apt.html</a></p>
<h1></h1>
<h2>报错：configure: error: Unable to find libevent</h2>
<p>于是我用apt-cache　search了一下：libevent，
还是找到了这个:
<code>sudo apt-get install libevent-dev</code>．
就好了．</p>
<h2>报错:需要的目标 gtest-1.7.0/src/gtest-all.cc</h2>
<p>查到github issues上有人遇到跟我同样的问题：<a href="https://github.com/facebook/folly/issues/335">#335</a>
说拷贝gtest代码到test/gtest下面，于是从google上搜索了一下gtest-1.7.0 找到了这个：<a href="https://github.com/m-lab/libraries/tree/master/third_party/gtest-1.7.0">gtest-1.7.0d代码地址</a>
按照这个代码仓库上的，直接去下载<code>gtest-1.7.0.tar.gz</code>解压，拷贝到redex目录下的test目录下即可测试。</p>
<h2>安装完成后执行redex命令时报错： Couldn&#x27;t find zipalign.</h2>
<p>这个问题实际就是连个原因</p>
<blockquote>
<ul>
<li>打包时没有开启zip的原因</li>
<li>第二个原因就是机器上没有配置android环境变量的问题
第一问题简单，直接</li>
</ul>
</blockquote>
<pre><code>android {

    buildTypes {
        debug {
            zipAlignEnabled true
        }
   }
}
</code></pre>
<p>由于android IDE已经非常高明了，完全不需要配置环境变量了,所以我也一直都没有配置环境变量，这次不得不配置了，不然命令行太弱智了，找不到android 的sdk路径。</p>
<pre><code class="language-xml">echo &#x27;export ANDROID_HOME=&quot;&#x27;$HOME&#x27;/文档/tools/android-sdk-linux&quot;&#x27; &gt;&gt; ~/.bashrc
echo &#x27;export PATH=&quot;$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools&quot;&#x27; &gt;&gt; ~/.bashrc
echo &#x27;export JAVA_CMD=&quot;/home/wei/文档/tools/jdk1.7.0_76/bin/java&quot;&#x27; &gt;&gt; ~/.bashrc

redex /home/wei/桌面/app.apk -o /home/wei/桌面/output.apk


echo  &#x27;export PATH=&quot;$PATH:&#x27;$HOME&#x27;/文档/tools/android-sdk-linux/build-tools/23.0.2&quot;&#x27; &gt;&gt; ~/.bashrc
</code></pre>
<p>环境变量生成需要关闭终端，重新启动一个终端，重新执行redex命令即可。</p>
<h1></h1>
<p>既然是未签名的apk，那么需要重新签名：　<a href="http://developer.android.com/tools/publishing/app-signing.html#signing-manually">google告诉我们给apk签名的方案，链接在此点我跳转。</a></p>
<pre><code> 注意：facebook在github上给出了mac linux开发者的使用方式，但是windows狗没有方法使用了，so，哈哈哈！！windows狗没有春天！！！
</code></pre>
<hr/></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"使用Facebook的Redex工具进行android app运行优化","title":"使用Facebook的Redex工具进行android app运行优化.md","mdsource":"md/使用Facebook的Redex工具进行android app运行优化.md","date":" 2016/04/15 10:04:47","category":"几年后回看会觉得写的太烂"},"content":"title: 使用Facebook的Redex工具进行android app运行优化\ndate: 2016/04/15 10:04:47\nupdated: 2016/04/29 21:21:17\ncategories:\n- 技术\n---\n![](assets/fb_logo.jpg)\n\n    抱歉：我又盗了别人家的图,从网上偷了一个facebook的logo。哈哈哈！！！！好了回到正题。\n    \n    去年，Facebook使用叫ReDex的字节码优化工具优化了他们的安卓应用的性能.\n\n    昨天收到消息，ReDex已经重新发布了。安卓开发者可以免费地使用这个工具优化自己的应用。也可以将它用作其它安卓字节码优化工具的基础。\n    \n    在Facebook工程博客的一篇文章中指出，`dex`并不是按照应用启动时候加载的顺序加载的，而是按照编译工具指定的顺序加载的。\n    \n    ReDex使程序运行时产生的运行数据判定哪些类应该在.DEX文件中被优先载入。“想要最小化从内存中读取数据的次数，最好从启动的时候就载入字节码。”Facebook称，他们使用ReDex对应用优化之后，对存储的读取减少了25%，运行速度提高了30%。\n    关于这个速度，Facebook称，在存储较慢的老旧机器上效果非常明显，但是对于新的收集，性能也有明显的提高。\n    \n    Facebook在一台搭载了安卓4.4的全新的Nexus4上（有35%的安卓设备运行这个版本）测试，启动时间从2秒降至1.6秒。\n\n    Runtime分析可以用来删除无关的元数据和接口，但是开发者也可以自定义优化的行为。比如，有些方法即使没有直接被调用，也可以让它们保留下来。\n\n    这个优化是在应用编译完成之后进行的。也就是说，理论上你也可以结合其他优化，比如对Java进行虚拟机层的优化和语言的优化，像即将到来的Java 9的语言模块特性等等。\n    优化Java的字节码文件并不是一种新技术。还有其他的开源项目，例如ProGuard就可以通过删除运行时没有使用的代码进行优化。但是它并不能像ReDex那样按照执行顺序来重新组织类。\n\n这里值得一提的是redex这个项目，虽然facebook玩了一年了，但是github上这个项目第一次commit的日期是`Commits on Apr 7, 2016`。\n不是这帮技术宅一直没开源出来，而是他们最早它是挂在[folly这个项目](https://github.com/facebook/folly)下面的。\n\n\n--------------------\n\n----------- 我是一个可爱的分割线 (⊙_⊙;)---------------\n\n--------------------\n\n    由于只是开放源代码，但是没有提出来做成一个软件给我们用，但是我是linux，我可以就直接下载代码make install就可以运行redex了。\n## 下面是我所遇到的所有问题\n# \n安装过程在[facebook的github](https://github.com/facebook/redex)上已经写的很清楚，但是linux总是各种问题你懂得，等着你去解决它。\n\n## 报错： autoreconf: 'configure.ac' or 'configure.in' is required的解决\n\n于是从Git上找到了这个：\nDownload and install double-conversion:\n```\n  git clone https://github.com/google/double-conversion.git\n  cd double-conversion\n  cmake -DBUILD_SHARED_LIBS=ON .\n  make\n  sudo make install\n```\n之后再执行　   `autoreconf -ivf`\n\n\n## 报错：error: possibly undefined macro: AM_PROG_LIBTOOL       If this token and others are legitimate, please use m4_pattern_allow的解决\n\n#\n\n然后又从stackoverflow上找到了这个：\n[How do I resolve an error about AM_PROG_LIBTOOL when building libopus from git?](http://superuser.com/questions/653172/how-do-i-resolve-an-error-about-am-prog-libtool-when-building-libopus-from-git/653173)\n# \n我`install libtool`之后，终于不在报错\n``` xml\n...\n...\nparallel-tests: installing 'build-aux/test-driver'\nautoreconf: Leaving directory `.'\n```\n# \n继续执行：\n``` shell\n\n//然后又是巴拉巴拉一堆log：\n...\n...\n...\nchecking if g++ supports C++0x features without additional flags... no\nchecking if g++ supports C++0x features with -std=c++0x... yes\nchecking if g++ supports C++0x features with -std=gnu++0x... yes\nchecking for main in -lgflags... no\nconfigure: error: Please install google-gflags library\n\n```\n# \n## 报错：Please install google-gflags library的解决\n# \n这个问题在github上这个仓库的issues中也有提到：\nhttps://github.com/facebook/folly/issues/117\n但是这个issues并没有什么卵用：\n最后还是找了这个：\nhttp://caffe.berkeleyvision.org/install_apt.html\n\n# \n## 报错：configure: error: Unable to find libevent\n\n于是我用apt-cache　search了一下：libevent，\n还是找到了这个:\n`sudo apt-get install libevent-dev`．\n就好了．\n\n\n## 报错:需要的目标 gtest-1.7.0/src/gtest-all.cc\n\n查到github issues上有人遇到跟我同样的问题：[#335](https://github.com/facebook/folly/issues/335)\n说拷贝gtest代码到test/gtest下面，于是从google上搜索了一下gtest-1.7.0 找到了这个：[gtest-1.7.0d代码地址](https://github.com/m-lab/libraries/tree/master/third_party/gtest-1.7.0)\n按照这个代码仓库上的，直接去下载`gtest-1.7.0.tar.gz`解压，拷贝到redex目录下的test目录下即可测试。\n\n##  安装完成后执行redex命令时报错： Couldn't find zipalign.\n这个问题实际就是连个原因\n\u003e + 打包时没有开启zip的原因\n\u003e + 第二个原因就是机器上没有配置android环境变量的问题\n第一问题简单，直接\n```\nandroid {\n\n    buildTypes {\n        debug {\n            zipAlignEnabled true\n        }\n   }\n}\n```\n由于android IDE已经非常高明了，完全不需要配置环境变量了,所以我也一直都没有配置环境变量，这次不得不配置了，不然命令行太弱智了，找不到android 的sdk路径。\n\n```xml\necho 'export ANDROID_HOME=\"'$HOME'/文档/tools/android-sdk-linux\"' \u003e\u003e ~/.bashrc\necho 'export PATH=\"$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools\"' \u003e\u003e ~/.bashrc\necho 'export JAVA_CMD=\"/home/wei/文档/tools/jdk1.7.0_76/bin/java\"' \u003e\u003e ~/.bashrc\n\nredex /home/wei/桌面/app.apk -o /home/wei/桌面/output.apk\n\n\necho  'export PATH=\"$PATH:'$HOME'/文档/tools/android-sdk-linux/build-tools/23.0.2\"' \u003e\u003e ~/.bashrc\n```\n环境变量生成需要关闭终端，重新启动一个终端，重新执行redex命令即可。\n# \n既然是未签名的apk，那么需要重新签名：　[google告诉我们给apk签名的方案，链接在此点我跳转。](http://developer.android.com/tools/publishing/app-signing.html#signing-manually)\n\n     注意：facebook在github上给出了mac linux开发者的使用方式，但是windows狗没有方法使用了，so，哈哈哈！！windows狗没有春天！！！\n\n--------------------------\n\n\n","lang":"cn"},"__N_SSG":true},"page":"/[lang]/blog/[slug]","query":{"lang":"cn","slug":"使用Facebook的Redex工具进行android app运行优化"},"buildId":"zaycUZ6jvMLykcBwRP9wT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>