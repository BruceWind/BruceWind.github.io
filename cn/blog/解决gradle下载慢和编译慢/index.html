<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><meta name="emotion-insertion-point" content=""/><title>解决gradle下载慢和编译慢.md<!-- --> - BruceWind&#x27;s Blog</title><meta name="description" content="解决gradle下载慢和编译慢.md - 几年后回看会觉得写的太烂"/><meta property="og:title" content="解决gradle下载慢和编译慢.md"/><meta property="og:type" content="article"/><meta property="article:published_time" content=" 2016/03/05 23:37:38"/><meta name="next-head-count" content="8"/><meta charSet="utf-8"/><meta name="keywords" content="NDK,JNI,Android Dev,android,androidyuan,性能优化,Linux,developer"/><meta name="description" content="BruceWind&#x27;s personal blog - Android development, Linux, and more."/><meta name="robots" content="index,follow"/><meta name="google" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="author" content="bruce"/><link rel="icon" href="/favicon.ico"/><meta name="theme-color" content="#000000"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LGE1LT9YJG"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-LGE1LT9YJG');
              </script><style data-emotion="mui-style-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-style 17ro72p 1cp6o32 79elbk 1qo0fs4 1uf4bbi 1m9pwf3 19gndve 1ju1kxc k1u9gz 6xugel 1k33q06 gtvj52 1x1vlev vax71z">.mui-style-17ro72p{width:100%;min-height:100vh;background-color:#fff;padding:16px;}.mui-style-1cp6o32{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12);padding:24px;}.mui-style-79elbk{position:relative;}.mui-style-1qo0fs4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;width:58px;height:38px;overflow:hidden;padding:12px;box-sizing:border-box;position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;z-index:0;vertical-align:middle;width:62px;height:34px;padding:7px;margin:8px;}@media print{.mui-style-1qo0fs4{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1qo0fs4 .MuiSwitch-switchBase{margin:1px;padding:0;-webkit-transform:translateX(6px);-moz-transform:translateX(6px);-ms-transform:translateX(6px);transform:translateX(6px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked{color:#fff;-webkit-transform:translateX(22px);-moz-transform:translateX(22px);-ms-transform:translateX(22px);transform:translateX(22px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked .MuiSwitch-thumb:before{background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><path d="M0 0h24v24H0z" fill="none"/><path fill="white" d="M12 19a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5.5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm11 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13 2v2h6v2h-1.968a18.222 18.222 0 0 1-3.621 6.302 14.685 14.685 0 0 0 5.327 3.042l-.536 1.93A16.685 16.685 0 0 1 12 13.726a16.696 16.696 0 0 1-6.202 3.547l-.536-1.929a14.7 14.7 0 0 0 5.327-3.042 18.077 18.077 0 0 1-2.822-4.3h2.24A16.031 16.031 0 0 0 12 10.876a16.168 16.168 0 0 0 2.91-4.876L5 6V4h6V2h2z"/></g></svg>');}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked+.MuiSwitch-track{opacity:1;background-color:#aab4be;}.mui-style-1qo0fs4 .MuiSwitch-thumb{background-color:#001e3c;width:32px;height:32px;}.mui-style-1qo0fs4 .MuiSwitch-thumb:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none" /><path fill="white" d="M14 10h2v.757a4.5 4.5 0 0 1 7 3.743V20h-2v-5.5c0-1.43-1.175-2.5-2.5-2.5S16 13.07 16 14.5V20h-2V10zm-2-6v2H4v5h8v2H4v5h8v2H2V4h10z"/></svg>');}.mui-style-1qo0fs4 .MuiSwitch-track{opacity:1;background-color:#aab4be;border-radius:10px;}.mui-style-1uf4bbi{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;padding:9px;border-radius:50%;position:absolute;top:0;left:0;z-index:1;color:#fff;-webkit-transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,-webkit-transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.mui-style-1uf4bbi::-moz-focus-inner{border-style:none;}.mui-style-1uf4bbi.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-1uf4bbi{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1uf4bbi.Mui-checked{-webkit-transform:translateX(20px);-moz-transform:translateX(20px);-ms-transform:translateX(20px);transform:translateX(20px);}.mui-style-1uf4bbi.Mui-disabled{color:#f5f5f5;}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{opacity:0.5;}.mui-style-1uf4bbi.Mui-disabled+.MuiSwitch-track{opacity:0.12;}.mui-style-1uf4bbi .MuiSwitch-input{left:-100%;width:300%;}.mui-style-1uf4bbi:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.mui-style-1uf4bbi:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked{color:#1976d2;}.mui-style-1uf4bbi.Mui-checked:hover{background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-1uf4bbi.Mui-checked:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked.Mui-disabled{color:rgb(167, 202, 237);}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{background-color:#1976d2;}.mui-style-1m9pwf3{cursor:inherit;position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;margin:0;padding:0;z-index:1;}.mui-style-19gndve{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);background-color:currentColor;width:20px;height:20px;border-radius:50%;}.mui-style-1ju1kxc{height:100%;width:100%;border-radius:7px;z-index:-1;-webkit-transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;background-color:#000;opacity:0.38;}.mui-style-k1u9gz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;margin-bottom:16px;}.mui-style-k1u9gz::-moz-focus-inner{border-style:none;}.mui-style-k1u9gz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-k1u9gz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-k1u9gz:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-k1u9gz:hover{background-color:transparent;}}.mui-style-k1u9gz.Mui-disabled{color:rgba(0, 0, 0, 0.26);}.mui-style-6xugel{display:inherit;margin-right:8px;margin-left:-4px;}.mui-style-6xugel>*:nth-of-type(1){font-size:20px;}.mui-style-1k33q06{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.25rem;}.mui-style-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}.mui-style-1x1vlev{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;margin-bottom:0.35em;color:rgba(0, 0, 0, 0.6);}.mui-style-vax71z{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;margin-top:16px;margin-bottom:16px;}</style><link rel="preload" href="/_next/static/css/345ff263c1768dbb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/345ff263c1768dbb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-5b2299ded1a46c83.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4f0aaa3a6ba99024.js" defer=""></script><script src="/_next/static/chunks/34-75ae01f5fa578a9a.js" defer=""></script><script src="/_next/static/chunks/995-1a3bc1a098c2d99b.js" defer=""></script><script src="/_next/static/chunks/771-6a778ea1fc3e748f.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blang%5D/blog/%5Bslug%5D-0f929ec094b5fc83.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_buildManifest.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="MuiBox-root mui-style-17ro72p"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation3 mui-style-1cp6o32"><div class="MuiBox-root mui-style-79elbk"><div style="position:fixed;top:22px;right:15px;z-index:1300"><span class="MuiSwitch-root MuiSwitch-sizeMedium mui-style-1qo0fs4"><span class="MuiButtonBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked PrivateSwitchBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked Mui-checked mui-style-1uf4bbi"><input class="PrivateSwitchBase-input MuiSwitch-input mui-style-1m9pwf3" type="checkbox" checked=""/><span class="MuiSwitch-thumb mui-style-19gndve"></span></span><span class="MuiSwitch-track mui-style-1ju1kxc"></span></span></div><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary mui-style-k1u9gz" tabindex="0" href="/cn/"><span class="MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium mui-style-6xugel"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall mui-style-1k33q06" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"></path></svg></span>返回列表</a><h1 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom mui-style-gtvj52">解决gradle下载慢和编译慢.md</h1><p class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom mui-style-1x1vlev">几年后回看会觉得写的太烂<!-- --> | <!-- --> 2016/03/05 23:37:38</p><hr class="MuiDivider-root MuiDivider-fullWidth mui-style-vax71z"/><div class="markdown-body"><p>title: 解决gradle下载慢和编译慢
date: 2016/03/05 23:37:38
updated: 2016/03/06 09:13:18
categories:</p>
<ul>
<li>技术</li>
</ul>
<hr/>
<p>由于各种不可描述的原因境内下载很慢。
本文是围绕gradle目录的gradle-xxxx-all.zip下载慢，和依赖的aar,jar下载慢这两块。linux或mac环境，windows用户不用看下去了。</p>
<h1>一：解决下载缓慢</h1>
<hr/>
<h2>1.直接代理</h2>
<blockquote>
<ul>
<li>合格大陆程序员一定要有代理，没有代理的二流程序员请跳过这部分：</li>
</ul>
</blockquote>
<h3>1.a.命令行下所有的http(s)请求加代理（不止gradle命令）</h3>
<p>推荐使用别名加如到<strong>~/.bashrc</strong>最后一行，这样子当你需要下载各种东西的时候用别名代替输入这行字符串非常方便。</p>
<pre><code>alias proxyterminal=&#x27;export http_proxy=http://127.0.0.1:1080;export https_proxy=http://127.0.0.1:1080;&#x27;
</code></pre>
<h3>1.b.给gradle命令编译配置独立的http代理：</h3>
<p>编辑<strong>~/.gradle/gradle.properties</strong>:</p>
<pre><code>//cat ~/.gradle/gradle.properties
systemProp.http.proxyHost=127.0.0.1
systemProp.http.proxyPort=1080

systemProp.https.proxyPort=1080
systemProp.https.proxyHost=127.0.0.1

systemProp.http.nonProxyHosts=*.cn|localhost|*.aliyun.com|172.*|10.23*|192.168*|*.cn
systemProp.https.nonProxyHosts=*.cn|localhost|*.aliyun.com|172.*|10.23*|192.168*|*.cn
</code></pre>
<p>你项目根目录的配置文件<strong>gradle.properties</strong>也可以拷贝这个进行配置。</p>
<p>如果您有代理，那就没必要再往下看了。<strong>全剧终止！</strong></p>
<h2>2.下载gradle-xxxx-all.zip(无代理)：</h2>
<h3>2.a.使用官方cdn节点下载</h3>
<p><del><a href="https://services.gradle.org/distributions/gradle-6.6-all.zip">https://services.gradle.org/distributions/gradle-6.6-all.zip</a></del></p>
<p><a href="https://downloads.gradle-dn.com/distributions/gradle-6.6-all.zip">https://downloads.gradle-dn.com/distributions/gradle-6.6-all.zip</a></p>
<h3>2.b.手动下载放置目录（使用其他下载器）</h3>
<p>下载好丢到~/.gradle/wrapper/dists这个目录里，再重启as，或者命令行重新编译。</p>
<h1></h1>
<h3>2.c.下载zip传到git上去</h3>
<p>你保存到当前project根目录,/project/gradle/wrapper/下,
并且修改<strong>gradle-wrapper.properties</strong>文件。
<code>distributionUrl=gradle-2.2.1-all.zip</code>
之后就可以在idea或者as中rebuild一下即可。这里就可以跳过下载gradle的过程，继续下载依赖的jcenter代码库了。
这时候直接<code>git lfs track &quot;*.zip&quot; &amp; git add /project/gradle/wrapper/gradle-2.2.1-all.zip</code>,然后把这个推到你们的git服务器上去。
<strong>git lfs</strong>是large file服务，不懂请联系运维。</p>
<h2>3.解决依赖的aar,jar下载慢(无代理)</h2>
<h3>3.a 走国内镜像：</h3>
<pre><code>//该方案不能解决所有依赖，可能当前仓库部分的依赖是aliyun里没有的。
allProjects {
    repositories {
		maven { url &#x27;https://maven.aliyun.com/repository/public/&#x27; }
        maven { url &#x27;https://maven.aliyun.com/repository/google/&#x27;}
        maven { url &#x27;https://maven.aliyun.com/repository/jcenter/&#x27;}

        mavenLocal()
        mavenCentral()
    }
}
//这里没有google的镜像，主要google在我这边测试速度还挺快，应该他们自己弄了国内的节点。
</code></pre>
<h2>3.a 自建nexus镜像</h2>
<p>找公司申请一台台式机，弄个局域网的nexus镜像服务器。</p>
<h1>二.gradle开启multidex之后构建缓慢问题</h1>
<hr/>
<p>项目越来越大，导入各种第三方的包，导致项目java方法数很轻松超过64K，那么gradle构建就会轻易的进入到一种很蛋疼的境地，直接报错  <code>/user/jdk/bin/.....  exit 2.</code>
那么解决方案只有一个就是 开启mutidex，multidex就会带来构建缓慢的问题。
就算我们开发本机有jcenter，maven库和gradle缓存，依旧是构建很慢。</p>
<h1></h1>
<p>找到的一些解决构建速度问题的方法。如下：</p>
<h2>1.可以考虑增加 studio.vmoptions 中内存设置</h2>
<p>使用idea或者as开发,可以到编译器所在的主目录下搜索*.vmoptions 文件,可能会搜索到两个文件.  一个32位的一个6x64的，打开那个文件修改&#x27;-Xmx....&#x27;，  这个是最大申请内存限制的配置，配置之后，重启下 IDE。</p>
<h2>2. 使用最新版本gradle</h2>
<h2>３.请更改minsdkversion 版本 和ssd</h2>
<p>首先必须保证 SSD 和通畅的网络环境；
ssd主要是解决构建大量的IO的问题。</p>
<p>其次可以考虑增加 studio.vmoptions 中内存设置；
如果是大项目 (multidex) 编译慢我知道一招，Gradle 中添加</p>
<pre><code>    defaultConfig {
        ......
        if (gradle.startParameter.taskNames.contains(&quot;:app:assembleDebug&quot;)) {
            minSdkVersion 21
        }else{
            minSdkVersion 18
        }
    }
</code></pre>
<p>minSdkVersion 设置为 Android API 级别 21 的调试应用。这些设置会使 Android Gradle 插件执行以下操作：</p>
<blockquote>
<ul>
<li>每个子模块构建为单独的dex文件。不再做合并操作。因此可以避免为确定主 dex 文件的内容而进行长时间的计算。</li>
<li>将每个 dex 文件加入 APK 时不做任何修改。</li>
</ul>
</blockquote>
<p>不过这个方案的弊端就是：
如果开发机 SDKVersion 没到 21 就跑不起来了；
如果用不到 multidex 还觉得编译慢请升级机器；</p>
<h1></h1>
<p>用了这个之后，就在18s左右了。已经跟ios编译速度相等了。
这个方案后来还是没有使用，在全民TV，公司给研发同学的机器依旧有一半是低于5.0的设备，没办法，部分研发调试都无法用了，很蛋疼。不使用这个功能，其他的都配置了，编译速度从2分钟降到50s左右了，总之不是很理想。</p>
<h2>4.加大javaheap内存限制  （要求开发的电脑内存要大于4G）</h2>
<pre><code>    dexOptions {//解决构建缓慢问题
        javaMaxHeapSize &quot;4g&quot; //当然可以更大 
    }
</code></pre>
<h2>5.修改默认配置 (改善命令行编译)</h2>
<p>在gradle 目录下“创建 <code>gradle.properties</code>文件，gradle目录在
<code>~/.gradle/ (Linux) ~/.gradle/ (Mac) C:\Users\&lt;username&gt;\.gradle (Windows)</code>
文件内写：
<code>org.gradle.daemon=true //进程守护 org.gradle.parallel=true</code></p>
<h2>6.使用官方gradle提供的分析工具</h2>
<p>官方耗时分析工具,可以帮忙分析耗时的位置,</p>
<pre><code>./gradlew --profile --recompile-scripts --offline --rerun-tasks assembleDebug
//只分析debug模式下的情况.
</code></pre>
<pre><code>导出的HTMl的部分内容:
Profile report
Profiled build: assembleDebug

Started on: 2017/03/23 - 12:35:47

Summary
Configuration
Dependency Resolution
Task Execution
Description	Duration
Total Build Time	1m18.44s
Startup	1.361s
Settings and BuildSrc	0.496s
Loading Projects	0.205s
Configuring Projects	5.912s
Task Execution	2m29.34s
</code></pre>
<h2>7.修改gradle所在虚拟机的xmx参数</h2>
<p>gradle-wrapper.properties</p>
<pre><code>&gt; 修改gradle所在JVM的xmx参数,但是生效需要 重启 gradle
org.gradle.jvmargs = -Xmx2048m
</code></pre>
<p>一些较大的项目可能会受益于更大的Gradle堆大小。但是，如果使用低内存计算机，则可能需要将IDE配置为使用更少的内存。要了解如何更改分配给IDE和Gradle的资源数量会影响构建性能，请转到关于概要分析构建的部分。</p>
<p>注意：如果Gradle守护程序已经运行，则需要在使用新设置进行初始化之前停止该进程。您可以通过选择View&gt; Tool Windows&gt; Terminal终止并输入以下命令来终止Gradle守护程序：gradlew --stop。</p>
<h2>8.忽略配置直接命令行编译</h2>
<pre><code>./gradlew assembleDebug  -x lint  --parallel --max-workers=6   -PminSdk=21
</code></pre>
<p>公司给我配的是高配Thinkpad, 固态盘，i7处理器，8G ram。之前是1分50秒降到50秒以内的构建速度。更改如上这些东西之后，是50秒以内。同事的mac laptop要比我的linux还快几秒。</p>
<h1>三.解决由开启了multidex带来的app性能下降的问题</h1>
<hr/>
<p>前面说了一些编译器的问题解决，但是终究apk的性能问题还是丢在这里没人过问
使用TurboDex</p>
<pre><code>摘录自turbodex
</code></pre>
<p>众所周知,Android中在Runtime加载一个 未优化的Dex文件 (尤其在 ART 模式)需要花费 很长的时间. 当你在App中使用 MultiDex 或 插件化框架 的时候, 这个问题就会显得十分严重.</p>
<p>TurboDex 就是为了解决这一问题而生, 就像是给AndroidVM开启了上帝模式, 在引入TurboDex后, 无论你加载了多大的Dex文件,都可以在毫秒级别内完成.</p>
<pre><code>TurboDex 的使用始终是好的，就算你的项目构建没有开启multidex也是可以使用的。
</code></pre></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"解决gradle下载慢和编译慢","title":"解决gradle下载慢和编译慢.md","mdsource":"md/解决gradle下载慢和编译慢.md","date":" 2016/03/05 23:37:38","category":"几年后回看会觉得写的太烂"},"content":"title: 解决gradle下载慢和编译慢\ndate: 2016/03/05 23:37:38\nupdated: 2016/03/06 09:13:18\ncategories:\n- 技术\n---\n由于各种不可描述的原因境内下载很慢。\n本文是围绕gradle目录的gradle-xxxx-all.zip下载慢，和依赖的aar,jar下载慢这两块。linux或mac环境，windows用户不用看下去了。\n\n# 一：解决下载缓慢\n-------\n\n## 1.直接代理\n\n\u003e + 合格大陆程序员一定要有代理，没有代理的二流程序员请跳过这部分：\n\n### 1.a.命令行下所有的http(s)请求加代理（不止gradle命令）\n推荐使用别名加如到**~/.bashrc**最后一行，这样子当你需要下载各种东西的时候用别名代替输入这行字符串非常方便。\n```\nalias proxyterminal='export http_proxy=http://127.0.0.1:1080;export https_proxy=http://127.0.0.1:1080;'\n```\n### 1.b.给gradle命令编译配置独立的http代理：\n编辑**~/.gradle/gradle.properties**:\n\n```\n//cat ~/.gradle/gradle.properties\nsystemProp.http.proxyHost=127.0.0.1\nsystemProp.http.proxyPort=1080\n\nsystemProp.https.proxyPort=1080\nsystemProp.https.proxyHost=127.0.0.1\n\nsystemProp.http.nonProxyHosts=*.cn|localhost|*.aliyun.com|172.*|10.23*|192.168*|*.cn\nsystemProp.https.nonProxyHosts=*.cn|localhost|*.aliyun.com|172.*|10.23*|192.168*|*.cn\n```\n你项目根目录的配置文件**gradle.properties**也可以拷贝这个进行配置。\n\n\n如果您有代理，那就没必要再往下看了。**全剧终止！**\n\n## 2.下载gradle-xxxx-all.zip(无代理)：\n\n### 2.a.使用官方cdn节点下载\n\n~~https://services.gradle.org/distributions/gradle-6.6-all.zip~~\n\nhttps://downloads.gradle-dn.com/distributions/gradle-6.6-all.zip\n\n\n### 2.b.手动下载放置目录（使用其他下载器）\n下载好丢到~/.gradle/wrapper/dists这个目录里，再重启as，或者命令行重新编译。\n\n# \n\n### 2.c.下载zip传到git上去\n你保存到当前project根目录,/project/gradle/wrapper/下,\n并且修改**gradle-wrapper.properties**文件。\n```distributionUrl=gradle-2.2.1-all.zip```\n之后就可以在idea或者as中rebuild一下即可。这里就可以跳过下载gradle的过程，继续下载依赖的jcenter代码库了。\n这时候直接`git lfs track \"*.zip\" \u0026 git add /project/gradle/wrapper/gradle-2.2.1-all.zip`,然后把这个推到你们的git服务器上去。\n**git lfs**是large file服务，不懂请联系运维。\n\n## 3.解决依赖的aar,jar下载慢(无代理)\n\n### 3.a 走国内镜像：\n\n```\n//该方案不能解决所有依赖，可能当前仓库部分的依赖是aliyun里没有的。\nallProjects {\n    repositories {\n\t\tmaven { url 'https://maven.aliyun.com/repository/public/' }\n        maven { url 'https://maven.aliyun.com/repository/google/'}\n        maven { url 'https://maven.aliyun.com/repository/jcenter/'}\n\n        mavenLocal()\n        mavenCentral()\n    }\n}\n//这里没有google的镜像，主要google在我这边测试速度还挺快，应该他们自己弄了国内的节点。\n```\n\n## 3.a 自建nexus镜像\n\n找公司申请一台台式机，弄个局域网的nexus镜像服务器。\n\n\n# 二.gradle开启multidex之后构建缓慢问题\n-------\n\n项目越来越大，导入各种第三方的包，导致项目java方法数很轻松超过64K，那么gradle构建就会轻易的进入到一种很蛋疼的境地，直接报错  `/user/jdk/bin/.....  exit 2.`\n那么解决方案只有一个就是 开启mutidex，multidex就会带来构建缓慢的问题。\n就算我们开发本机有jcenter，maven库和gradle缓存，依旧是构建很慢。\n# \n找到的一些解决构建速度问题的方法。如下：\n\n## 1.可以考虑增加 studio.vmoptions 中内存设置\n\n使用idea或者as开发,可以到编译器所在的主目录下搜索*.vmoptions 文件,可能会搜索到两个文件.  一个32位的一个6x64的，打开那个文件修改'-Xmx....'，  这个是最大申请内存限制的配置，配置之后，重启下 IDE。\n\n## 2. 使用最新版本gradle\n\n\n## ３.请更改minsdkversion 版本 和ssd\n首先必须保证 SSD 和通畅的网络环境；\nssd主要是解决构建大量的IO的问题。\n\n其次可以考虑增加 studio.vmoptions 中内存设置；\n如果是大项目 (multidex) 编译慢我知道一招，Gradle 中添加\n```\n    defaultConfig {\n        ......\n        if (gradle.startParameter.taskNames.contains(\":app:assembleDebug\")) {\n            minSdkVersion 21\n        }else{\n            minSdkVersion 18\n        }\n    }\n```\nminSdkVersion 设置为 Android API 级别 21 的调试应用。这些设置会使 Android Gradle 插件执行以下操作：\n\n\u003e + 每个子模块构建为单独的dex文件。不再做合并操作。因此可以避免为确定主 dex 文件的内容而进行长时间的计算。\n\u003e + 将每个 dex 文件加入 APK 时不做任何修改。\n\n不过这个方案的弊端就是：\n如果开发机 SDKVersion 没到 21 就跑不起来了；\n如果用不到 multidex 还觉得编译慢请升级机器；\n# \n用了这个之后，就在18s左右了。已经跟ios编译速度相等了。\n这个方案后来还是没有使用，在全民TV，公司给研发同学的机器依旧有一半是低于5.0的设备，没办法，部分研发调试都无法用了，很蛋疼。不使用这个功能，其他的都配置了，编译速度从2分钟降到50s左右了，总之不是很理想。\n\n\n## 4.加大javaheap内存限制  （要求开发的电脑内存要大于4G）\n```\n    dexOptions {//解决构建缓慢问题\n        javaMaxHeapSize \"4g\" //当然可以更大 \n    }\n```\n\n## 5.修改默认配置 (改善命令行编译)\n在gradle 目录下“创建 `gradle.properties`文件，gradle目录在\n`\n~/.gradle/ (Linux)\n~/.gradle/ (Mac)\nC:\\Users\\\u003cusername\u003e\\.gradle (Windows)\n`\n文件内写：\n`\norg.gradle.daemon=true //进程守护\norg.gradle.parallel=true\n`\n\n## 6.使用官方gradle提供的分析工具\n官方耗时分析工具,可以帮忙分析耗时的位置,\n```\n./gradlew --profile --recompile-scripts --offline --rerun-tasks assembleDebug\n//只分析debug模式下的情况.\n```\n\n```\n导出的HTMl的部分内容:\nProfile report\nProfiled build: assembleDebug\n\nStarted on: 2017/03/23 - 12:35:47\n\nSummary\nConfiguration\nDependency Resolution\nTask Execution\nDescription\tDuration\nTotal Build Time\t1m18.44s\nStartup\t1.361s\nSettings and BuildSrc\t0.496s\nLoading Projects\t0.205s\nConfiguring Projects\t5.912s\nTask Execution\t2m29.34s\n```\n\n## 7.修改gradle所在虚拟机的xmx参数\n\ngradle-wrapper.properties\n```  \n\u003e 修改gradle所在JVM的xmx参数,但是生效需要 重启 gradle\norg.gradle.jvmargs = -Xmx2048m\n```\n\n一些较大的项目可能会受益于更大的Gradle堆大小。但是，如果使用低内存计算机，则可能需要将IDE配置为使用更少的内存。要了解如何更改分配给IDE和Gradle的资源数量会影响构建性能，请转到关于概要分析构建的部分。\n\n注意：如果Gradle守护程序已经运行，则需要在使用新设置进行初始化之前停止该进程。您可以通过选择View\u003e Tool Windows\u003e Terminal终止并输入以下命令来终止Gradle守护程序：gradlew --stop。\n\n## 8.忽略配置直接命令行编译\n```\n./gradlew assembleDebug  -x lint  --parallel --max-workers=6   -PminSdk=21\n```\n\n公司给我配的是高配Thinkpad, 固态盘，i7处理器，8G ram。之前是1分50秒降到50秒以内的构建速度。更改如上这些东西之后，是50秒以内。同事的mac laptop要比我的linux还快几秒。\n\n\n# 三.解决由开启了multidex带来的app性能下降的问题\n-------\n前面说了一些编译器的问题解决，但是终究apk的性能问题还是丢在这里没人过问\n使用TurboDex\n\n    摘录自turbodex\n众所周知,Android中在Runtime加载一个 未优化的Dex文件 (尤其在 ART 模式)需要花费 很长的时间. 当你在App中使用 MultiDex 或 插件化框架 的时候, 这个问题就会显得十分严重.\n\nTurboDex 就是为了解决这一问题而生, 就像是给AndroidVM开启了上帝模式, 在引入TurboDex后, 无论你加载了多大的Dex文件,都可以在毫秒级别内完成.\n\n    TurboDex 的使用始终是好的，就算你的项目构建没有开启multidex也是可以使用的。\n\n\n","lang":"cn"},"__N_SSG":true},"page":"/[lang]/blog/[slug]","query":{"lang":"cn","slug":"解决gradle下载慢和编译慢"},"buildId":"lw2IExpT7GBLnCqajAO6w","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>