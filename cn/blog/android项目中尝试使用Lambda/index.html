<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><meta name="emotion-insertion-point" content=""/><title>android项目中尝试使用Lambda.md<!-- --> - BruceWind&#x27;s Blog</title><meta name="description" content="android项目中尝试使用Lambda.md - 几年后回看会觉得写的太烂"/><meta property="og:title" content="android项目中尝试使用Lambda.md"/><meta property="og:type" content="article"/><meta property="article:published_time" content=" 2016/08/07 00:52:10"/><meta name="next-head-count" content="8"/><meta charSet="utf-8"/><meta name="keywords" content="NDK,JNI,Android Dev,android,androidyuan,性能优化,Linux,developer"/><meta name="description" content="BruceWind&#x27;s personal blog - Android development, Linux, and more."/><meta name="robots" content="index,follow"/><meta name="google" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="author" content="bruce"/><link rel="icon" href="/favicon.ico"/><meta name="theme-color" content="#000000"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LGE1LT9YJG"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-LGE1LT9YJG');
              </script><style data-emotion="mui-style-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-style 17ro72p 1cp6o32 79elbk 1qo0fs4 1uf4bbi 1m9pwf3 19gndve 1ju1kxc k1u9gz 6xugel 1k33q06 gtvj52 1x1vlev vax71z">.mui-style-17ro72p{width:100%;min-height:100vh;background-color:#fff;padding:16px;}.mui-style-1cp6o32{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12);padding:24px;}.mui-style-79elbk{position:relative;}.mui-style-1qo0fs4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;width:58px;height:38px;overflow:hidden;padding:12px;box-sizing:border-box;position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;z-index:0;vertical-align:middle;width:62px;height:34px;padding:7px;margin:8px;}@media print{.mui-style-1qo0fs4{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1qo0fs4 .MuiSwitch-switchBase{margin:1px;padding:0;-webkit-transform:translateX(6px);-moz-transform:translateX(6px);-ms-transform:translateX(6px);transform:translateX(6px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked{color:#fff;-webkit-transform:translateX(22px);-moz-transform:translateX(22px);-ms-transform:translateX(22px);transform:translateX(22px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked .MuiSwitch-thumb:before{background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><path d="M0 0h24v24H0z" fill="none"/><path fill="white" d="M12 19a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5.5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm11 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13 2v2h6v2h-1.968a18.222 18.222 0 0 1-3.621 6.302 14.685 14.685 0 0 0 5.327 3.042l-.536 1.93A16.685 16.685 0 0 1 12 13.726a16.696 16.696 0 0 1-6.202 3.547l-.536-1.929a14.7 14.7 0 0 0 5.327-3.042 18.077 18.077 0 0 1-2.822-4.3h2.24A16.031 16.031 0 0 0 12 10.876a16.168 16.168 0 0 0 2.91-4.876L5 6V4h6V2h2z"/></g></svg>');}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked+.MuiSwitch-track{opacity:1;background-color:#aab4be;}.mui-style-1qo0fs4 .MuiSwitch-thumb{background-color:#001e3c;width:32px;height:32px;}.mui-style-1qo0fs4 .MuiSwitch-thumb:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none" /><path fill="white" d="M14 10h2v.757a4.5 4.5 0 0 1 7 3.743V20h-2v-5.5c0-1.43-1.175-2.5-2.5-2.5S16 13.07 16 14.5V20h-2V10zm-2-6v2H4v5h8v2H4v5h8v2H2V4h10z"/></svg>');}.mui-style-1qo0fs4 .MuiSwitch-track{opacity:1;background-color:#aab4be;border-radius:10px;}.mui-style-1uf4bbi{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;padding:9px;border-radius:50%;position:absolute;top:0;left:0;z-index:1;color:#fff;-webkit-transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,-webkit-transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.mui-style-1uf4bbi::-moz-focus-inner{border-style:none;}.mui-style-1uf4bbi.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-1uf4bbi{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1uf4bbi.Mui-checked{-webkit-transform:translateX(20px);-moz-transform:translateX(20px);-ms-transform:translateX(20px);transform:translateX(20px);}.mui-style-1uf4bbi.Mui-disabled{color:#f5f5f5;}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{opacity:0.5;}.mui-style-1uf4bbi.Mui-disabled+.MuiSwitch-track{opacity:0.12;}.mui-style-1uf4bbi .MuiSwitch-input{left:-100%;width:300%;}.mui-style-1uf4bbi:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.mui-style-1uf4bbi:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked{color:#1976d2;}.mui-style-1uf4bbi.Mui-checked:hover{background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-1uf4bbi.Mui-checked:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked.Mui-disabled{color:rgb(167, 202, 237);}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{background-color:#1976d2;}.mui-style-1m9pwf3{cursor:inherit;position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;margin:0;padding:0;z-index:1;}.mui-style-19gndve{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);background-color:currentColor;width:20px;height:20px;border-radius:50%;}.mui-style-1ju1kxc{height:100%;width:100%;border-radius:7px;z-index:-1;-webkit-transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;background-color:#000;opacity:0.38;}.mui-style-k1u9gz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;margin-bottom:16px;}.mui-style-k1u9gz::-moz-focus-inner{border-style:none;}.mui-style-k1u9gz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-k1u9gz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-k1u9gz:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-k1u9gz:hover{background-color:transparent;}}.mui-style-k1u9gz.Mui-disabled{color:rgba(0, 0, 0, 0.26);}.mui-style-6xugel{display:inherit;margin-right:8px;margin-left:-4px;}.mui-style-6xugel>*:nth-of-type(1){font-size:20px;}.mui-style-1k33q06{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.25rem;}.mui-style-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}.mui-style-1x1vlev{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;margin-bottom:0.35em;color:rgba(0, 0, 0, 0.6);}.mui-style-vax71z{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;margin-top:16px;margin-bottom:16px;}</style><link rel="preload" href="/_next/static/css/345ff263c1768dbb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/345ff263c1768dbb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-5b2299ded1a46c83.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4f0aaa3a6ba99024.js" defer=""></script><script src="/_next/static/chunks/34-75ae01f5fa578a9a.js" defer=""></script><script src="/_next/static/chunks/995-1a3bc1a098c2d99b.js" defer=""></script><script src="/_next/static/chunks/771-6a778ea1fc3e748f.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blang%5D/blog/%5Bslug%5D-0f929ec094b5fc83.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_buildManifest.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="MuiBox-root mui-style-17ro72p"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation3 mui-style-1cp6o32"><div class="MuiBox-root mui-style-79elbk"><div style="position:fixed;top:22px;right:15px;z-index:1300"><span class="MuiSwitch-root MuiSwitch-sizeMedium mui-style-1qo0fs4"><span class="MuiButtonBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked PrivateSwitchBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked Mui-checked mui-style-1uf4bbi"><input class="PrivateSwitchBase-input MuiSwitch-input mui-style-1m9pwf3" type="checkbox" checked=""/><span class="MuiSwitch-thumb mui-style-19gndve"></span></span><span class="MuiSwitch-track mui-style-1ju1kxc"></span></span></div><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary mui-style-k1u9gz" tabindex="0" href="/cn/"><span class="MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium mui-style-6xugel"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall mui-style-1k33q06" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"></path></svg></span>返回列表</a><h1 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom mui-style-gtvj52">android项目中尝试使用Lambda.md</h1><p class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom mui-style-1x1vlev">几年后回看会觉得写的太烂<!-- --> | <!-- --> 2016/08/07 00:52:10</p><hr class="MuiDivider-root MuiDivider-fullWidth mui-style-vax71z"/><div class="markdown-body"><p>title: android项目中尝试使用Lambda
date: 2016/08/07 00:52:10
updated: 2016/08/11 10:41:34
categories:</p>
<ul>
<li>技术</li>
</ul>
<hr/>
<h1>android项目中尝试使用Lambda</h1>
<hr/>
<pre><code>最近一直在忙，也没空学习新的东西，然后公司需求又紧，所以就很久都没有更新博客，也没有在公众号上发新文章了。这个周末没有事情，就学习点东西来着。RxJava一直在看在写demo没有导入到项目中来。就在熟悉RxJava的时候发现这个好东西，所以觉得需要试试，发现用起来还比较简单，对于大项目而言，很大程度上可以降低代码行数。
</code></pre>
<h2>Lambda出现的意义和背景</h2>
<p>先看两个不同风格的代码：</p>
<pre><code class="language-java">public void func(Student stu)
{
    if(stu!=null)
    {
        //opt
        //opt
        //opt
    }

}


public void func(Student stu)
{
    if(stu==null)
        return;
    
    //opt
    //opt
    //opt
}

</code></pre>
<p>老司机往往都是下面这个代码，为什么呢？是为了避免代码的缩进，增加代码的易读性。但是涉及到匿名内部类和interface就难以解决换行缩紧的问题了。</p>
<h1></h1>
<p>我是做安卓开发，那么，我就拿安卓的代码例子来说。</p>
<pre><code class="language-java">
        btn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Log.d(&quot;XX&quot;,&quot;click&quot;);
            }
        });


        //使用lambda
        btn.setOnClickListener(e -&gt; Log.d(&quot;XX&quot;,&quot;click&quot;));
        
</code></pre>
<p>很明显这个代码在上面是6行代码，而使用了lambda只有1行代码，代码的精简和易读性是非常的赞。</p>
<h1></h1>
<h3>当然，你肯定说你这里onClick只有一行，如果多行代码怎么处理？</h3>
<pre><code>//只需要增加两个括号
view.setOnClickListener(e -&gt; {
                    Log.d(&quot;XX&quot;, &quot;click1&quot;);
                    Log.d(&quot;XX&quot;, &quot;click2&quot;);
                }
        );
</code></pre>
<hr/>
<h2>Lambda出现的背景</h2>
<p>1.匿名内部类
2.Interface函数</p>
<p>解决这两种代码使用时缩紧降低易读性的问题。</p>
<hr/>
<h2>解决低版本android兼容lambda语法问题</h2>
<p>目前只有Android N自带了java 8，而lambda又是java 8 中才出现的，低版本的android大多是java 6，只有5.0才是java7。兼容是个大问题。
两种方案：
1.谷歌官方给出的答案是使用jack工具链</p>
<pre><code>问题在于这个方案，兼容性和使用难度都比较大，问题比较多，所以基本放弃。
</code></pre>
<p>2.借助第三方实现。</p>
<pre><code>目前业内用的第三方插件大多是**retrolambda**。
</code></pre>
<p>详细教程retrolambda 的github上有说明的，这里我就再废话说一遍吧。
1.首先安装jdk 8
2.修改gradle</p>
<pre><code>
buildscript {
  repositories {
     mavenCentral()
  }

  dependencies {
     classpath &#x27;me.tatarka:gradle-retrolambda:3.2.5&#x27;
     //目前最新版是3.2.5
  }
}


apply plugin: &#x27;com.android.application&#x27; 
apply plugin: &#x27;me.tatarka.retrolambda&#x27;
</code></pre>
<p>3.修改language level</p>
<pre><code>android {
  compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
  }
}

</code></pre>
<p>4.解决混淆问题</p>
<pre><code>-dontwarn java.lang.invoke.* 
</code></pre>
<h2>使用中的一些例子</h2>
<p>上面有个runnable的例子，listener的例子，下面来个复杂点的listener例子。</p>
<pre><code>
list.setOnItemClickListener((parent,view,position,id)-&gt;{
	//opt
});
//或者
list.setOnItemClickListener((AdapterView&lt;?&gt; parent, View view, int position, long id)-&gt;{
	//opt
});

</code></pre>
<p>复杂使用内部类</p>
<pre><code>     // 使用内部类排序
     Collections.sort(personList, new Comparator&lt;Person&gt;(){
       public int compare(Person p1, Person p2){
         return p1.getSurName().compareTo(p2.getSurName());
       }
     });
     
     
     // 使用Lambda
     
     Collections.sort(personList, (Person p1, Person p2) -&gt; p1.getSurName().compareTo(p2.getSurName()));
     
     
     // 或者更佳简洁地使用Lambda
     
     Collections.sort(personList, (p1, p2) -&gt; p1.getSurName().compareTo(p2.getSurName()));

</code></pre>
<p>其中<code> (Person p1, Person p2)</code>是指明了Comparator类的一个多参数方法。
后面我也免去了Person类，这种代码里免去了类型，适用于没有重载两个参数的类。</p>
<h1></h1>
<p><strong>更多例子-&gt; <a href="http://jobar.iteye.com/blog/2023477">点我跳转</a></strong></p>
<h2>开发中遇到的问题</h2>
<p>1.Error:(25, 25) Gradle: 错误: -source 1.6 中不支持 lambda 表达式
(请使用 -source 8 或更高版本以启用 lambda 表达式)</p>
<pre><code>解决：忘记修改javaVersion版本1_6 改为1_8
</code></pre>
<pre><code>    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_6
        targetCompatibility JavaVersion.VERSION_1_6
    }

</code></pre>
<p>2.找不到id &#x27;me.tatarka.retrolambda&#x27; 或者 找不到 classpath()
<code>classpath &#x27;me.tatarka:gradle-retrolambda:3.2.5&#x27;</code>这行代码不是要写到 android dependencies 下面，而是 android buildscript dependencies下面。</p>
<p>3.找不到JAVA8_HOME环境变量</p>
<pre><code>    Execution failed for task &#x27;:app:compileDevReleaseJavaWithJavac&#x27;.
&gt; When running gradle with java 5, 6 or 7, you must set the path to jdk8, either with property retrolambda.jdk or environment variable JAVA8_HOME
</code></pre>
<p>这个retrolambda无法知道我当前的java版本，明显我是java8 他居然不能直接用我当前的java版本，非要我添加JAVA8_HOME环境变量。所以，这里手动添加下环境变量就好了。</p>
<p>4.大范围使用lambda容易导致团队中其他成员看不懂代码</p>
<pre><code>确实使用lambda可以减少一些代码，但是减少了不一定意味着易读性增加了，runnable interfece可以使用lambda，一些大家司空见惯的东西都一下能想的起来。
</code></pre>
<p>PS:有人说，无法调试问题，这个目前测试没有发现不能调试。</p>
<h1></h1>
<hr/>
<p>参考文档:
<a href="https://developer.android.com/preview/j8-jack.html">https://developer.android.com/preview/j8-jack.html</a>
<a href="https://github.com/evant/gradle-retrolambda">https://github.com/evant/gradle-retrolambda</a>
<a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html</a>
<a href="http://jobar.iteye.com/blog/2023477">http://jobar.iteye.com/blog/2023477</a></p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"android项目中尝试使用Lambda","title":"android项目中尝试使用Lambda.md","mdsource":"md/android项目中尝试使用Lambda.md","date":" 2016/08/07 00:52:10","category":"几年后回看会觉得写的太烂"},"content":"title: android项目中尝试使用Lambda\ndate: 2016/08/07 00:52:10\nupdated: 2016/08/11 10:41:34\ncategories:\n- 技术\n---\n# android项目中尝试使用Lambda\n---------\n    \n    最近一直在忙，也没空学习新的东西，然后公司需求又紧，所以就很久都没有更新博客，也没有在公众号上发新文章了。这个周末没有事情，就学习点东西来着。RxJava一直在看在写demo没有导入到项目中来。就在熟悉RxJava的时候发现这个好东西，所以觉得需要试试，发现用起来还比较简单，对于大项目而言，很大程度上可以降低代码行数。\n\n## Lambda出现的意义和背景\n先看两个不同风格的代码：\n\n``` java\npublic void func(Student stu)\n{\n    if(stu!=null)\n    {\n        //opt\n        //opt\n        //opt\n    }\n\n}\n\n\npublic void func(Student stu)\n{\n    if(stu==null)\n        return;\n    \n    //opt\n    //opt\n    //opt\n}\n\n```\n\n老司机往往都是下面这个代码，为什么呢？是为了避免代码的缩进，增加代码的易读性。但是涉及到匿名内部类和interface就难以解决换行缩紧的问题了。\n# \n我是做安卓开发，那么，我就拿安卓的代码例子来说。\n``` java\n\n        btn.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                Log.d(\"XX\",\"click\");\n            }\n        });\n\n\n        //使用lambda\n        btn.setOnClickListener(e -\u003e Log.d(\"XX\",\"click\"));\n        \n```\n很明显这个代码在上面是6行代码，而使用了lambda只有1行代码，代码的精简和易读性是非常的赞。\n#  \n### 当然，你肯定说你这里onClick只有一行，如果多行代码怎么处理？\n```\n//只需要增加两个括号\nview.setOnClickListener(e -\u003e {\n                    Log.d(\"XX\", \"click1\");\n                    Log.d(\"XX\", \"click2\");\n                }\n        );\n```\n------\n## Lambda出现的背景\n\n1.匿名内部类\n2.Interface函数\n\n解决这两种代码使用时缩紧降低易读性的问题。\n\n---------\n## 解决低版本android兼容lambda语法问题\n目前只有Android N自带了java 8，而lambda又是java 8 中才出现的，低版本的android大多是java 6，只有5.0才是java7。兼容是个大问题。\n两种方案：\n1.谷歌官方给出的答案是使用jack工具链\n    \n    问题在于这个方案，兼容性和使用难度都比较大，问题比较多，所以基本放弃。\n\n2.借助第三方实现。\n\n    目前业内用的第三方插件大多是**retrolambda**。\n\n详细教程retrolambda 的github上有说明的，这里我就再废话说一遍吧。\n1.首先安装jdk 8\n2.修改gradle \n```\n\nbuildscript {\n  repositories {\n     mavenCentral()\n  }\n\n  dependencies {\n     classpath 'me.tatarka:gradle-retrolambda:3.2.5'\n     //目前最新版是3.2.5\n  }\n}\n\n\napply plugin: 'com.android.application' \napply plugin: 'me.tatarka.retrolambda'\n```\n\n3.修改language level\n```\nandroid {\n  compileOptions {\n    sourceCompatibility JavaVersion.VERSION_1_8\n    targetCompatibility JavaVersion.VERSION_1_8\n  }\n}\n\n```\n4.解决混淆问题\n```\n-dontwarn java.lang.invoke.* \n```\n\n\n## 使用中的一些例子\n\n上面有个runnable的例子，listener的例子，下面来个复杂点的listener例子。\n```\n\nlist.setOnItemClickListener((parent,view,position,id)-\u003e{\n\t//opt\n});\n//或者\nlist.setOnItemClickListener((AdapterView\u003c?\u003e parent, View view, int position, long id)-\u003e{\n\t//opt\n});\n\n```\n\n\n复杂使用内部类\n```\n     // 使用内部类排序\n     Collections.sort(personList, new Comparator\u003cPerson\u003e(){\n       public int compare(Person p1, Person p2){\n         return p1.getSurName().compareTo(p2.getSurName());\n       }\n     });\n     \n     \n     // 使用Lambda\n     \n     Collections.sort(personList, (Person p1, Person p2) -\u003e p1.getSurName().compareTo(p2.getSurName()));\n     \n     \n     // 或者更佳简洁地使用Lambda\n     \n     Collections.sort(personList, (p1, p2) -\u003e p1.getSurName().compareTo(p2.getSurName()));\n\n```\n其中` (Person p1, Person p2)`是指明了Comparator类的一个多参数方法。\n后面我也免去了Person类，这种代码里免去了类型，适用于没有重载两个参数的类。\n# \n**更多例子-\u003e [点我跳转](http://jobar.iteye.com/blog/2023477)**\n\n## 开发中遇到的问题\n\n1.Error:(25, 25) Gradle: 错误: -source 1.6 中不支持 lambda 表达式\n(请使用 -source 8 或更高版本以启用 lambda 表达式)\n\n    解决：忘记修改javaVersion版本1_6 改为1_8\n    \n```\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_6\n        targetCompatibility JavaVersion.VERSION_1_6\n    }\n\n```\n\n2.找不到id 'me.tatarka.retrolambda' 或者 找不到 classpath()\n`classpath 'me.tatarka:gradle-retrolambda:3.2.5'`这行代码不是要写到 android dependencies 下面，而是 android buildscript dependencies下面。\n\n\n3.找不到JAVA8_HOME环境变量\n```\n    Execution failed for task ':app:compileDevReleaseJavaWithJavac'.\n\u003e When running gradle with java 5, 6 or 7, you must set the path to jdk8, either with property retrolambda.jdk or environment variable JAVA8_HOME\n```\n这个retrolambda无法知道我当前的java版本，明显我是java8 他居然不能直接用我当前的java版本，非要我添加JAVA8_HOME环境变量。所以，这里手动添加下环境变量就好了。\n\n4.大范围使用lambda容易导致团队中其他成员看不懂代码\n\n    确实使用lambda可以减少一些代码，但是减少了不一定意味着易读性增加了，runnable interfece可以使用lambda，一些大家司空见惯的东西都一下能想的起来。\n\n\nPS:有人说，无法调试问题，这个目前测试没有发现不能调试。\n\n\n# \n----------\n参考文档:\n    https://developer.android.com/preview/j8-jack.html\n    https://github.com/evant/gradle-retrolambda\n    https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html\n    http://jobar.iteye.com/blog/2023477","lang":"cn"},"__N_SSG":true},"page":"/[lang]/blog/[slug]","query":{"lang":"cn","slug":"android项目中尝试使用Lambda"},"buildId":"lw2IExpT7GBLnCqajAO6w","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>