<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><meta name="emotion-insertion-point" content=""/><title>android开发中模拟系统内存不足 应用释放的情况.md<!-- --> - BruceWind&#x27;s Blog</title><meta name="description" content="android开发中模拟系统内存不足 应用释放的情况.md - 几年后回看会觉得写的太烂"/><meta property="og:title" content="android开发中模拟系统内存不足 应用释放的情况.md"/><meta property="og:type" content="article"/><meta property="article:published_time" content=" 2015/09/02 00:25:03"/><meta name="next-head-count" content="8"/><meta charSet="utf-8"/><meta name="keywords" content="NDK,JNI,Android Dev,android,androidyuan,性能优化,Linux,developer"/><meta name="description" content="BruceWind&#x27;s personal blog - Android development, Linux, and more."/><meta name="robots" content="index,follow"/><meta name="google" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="author" content="bruce"/><link rel="icon" href="/favicon.ico"/><meta name="theme-color" content="#000000"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LGE1LT9YJG"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-LGE1LT9YJG');
              </script><style data-emotion="mui-style-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-style 17ro72p 1cp6o32 79elbk 1qo0fs4 1uf4bbi 1m9pwf3 19gndve 1ju1kxc k1u9gz 6xugel 1k33q06 gtvj52 1x1vlev vax71z">.mui-style-17ro72p{width:100%;min-height:100vh;background-color:#fff;padding:16px;}.mui-style-1cp6o32{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12);padding:24px;}.mui-style-79elbk{position:relative;}.mui-style-1qo0fs4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;width:58px;height:38px;overflow:hidden;padding:12px;box-sizing:border-box;position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;z-index:0;vertical-align:middle;width:62px;height:34px;padding:7px;margin:8px;}@media print{.mui-style-1qo0fs4{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1qo0fs4 .MuiSwitch-switchBase{margin:1px;padding:0;-webkit-transform:translateX(6px);-moz-transform:translateX(6px);-ms-transform:translateX(6px);transform:translateX(6px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked{color:#fff;-webkit-transform:translateX(22px);-moz-transform:translateX(22px);-ms-transform:translateX(22px);transform:translateX(22px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked .MuiSwitch-thumb:before{background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><path d="M0 0h24v24H0z" fill="none"/><path fill="white" d="M12 19a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5.5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm11 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13 2v2h6v2h-1.968a18.222 18.222 0 0 1-3.621 6.302 14.685 14.685 0 0 0 5.327 3.042l-.536 1.93A16.685 16.685 0 0 1 12 13.726a16.696 16.696 0 0 1-6.202 3.547l-.536-1.929a14.7 14.7 0 0 0 5.327-3.042 18.077 18.077 0 0 1-2.822-4.3h2.24A16.031 16.031 0 0 0 12 10.876a16.168 16.168 0 0 0 2.91-4.876L5 6V4h6V2h2z"/></g></svg>');}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked+.MuiSwitch-track{opacity:1;background-color:#aab4be;}.mui-style-1qo0fs4 .MuiSwitch-thumb{background-color:#001e3c;width:32px;height:32px;}.mui-style-1qo0fs4 .MuiSwitch-thumb:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none" /><path fill="white" d="M14 10h2v.757a4.5 4.5 0 0 1 7 3.743V20h-2v-5.5c0-1.43-1.175-2.5-2.5-2.5S16 13.07 16 14.5V20h-2V10zm-2-6v2H4v5h8v2H4v5h8v2H2V4h10z"/></svg>');}.mui-style-1qo0fs4 .MuiSwitch-track{opacity:1;background-color:#aab4be;border-radius:10px;}.mui-style-1uf4bbi{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;padding:9px;border-radius:50%;position:absolute;top:0;left:0;z-index:1;color:#fff;-webkit-transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,-webkit-transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.mui-style-1uf4bbi::-moz-focus-inner{border-style:none;}.mui-style-1uf4bbi.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-1uf4bbi{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1uf4bbi.Mui-checked{-webkit-transform:translateX(20px);-moz-transform:translateX(20px);-ms-transform:translateX(20px);transform:translateX(20px);}.mui-style-1uf4bbi.Mui-disabled{color:#f5f5f5;}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{opacity:0.5;}.mui-style-1uf4bbi.Mui-disabled+.MuiSwitch-track{opacity:0.12;}.mui-style-1uf4bbi .MuiSwitch-input{left:-100%;width:300%;}.mui-style-1uf4bbi:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.mui-style-1uf4bbi:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked{color:#1976d2;}.mui-style-1uf4bbi.Mui-checked:hover{background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-1uf4bbi.Mui-checked:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked.Mui-disabled{color:rgb(167, 202, 237);}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{background-color:#1976d2;}.mui-style-1m9pwf3{cursor:inherit;position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;margin:0;padding:0;z-index:1;}.mui-style-19gndve{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);background-color:currentColor;width:20px;height:20px;border-radius:50%;}.mui-style-1ju1kxc{height:100%;width:100%;border-radius:7px;z-index:-1;-webkit-transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;background-color:#000;opacity:0.38;}.mui-style-k1u9gz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;margin-bottom:16px;}.mui-style-k1u9gz::-moz-focus-inner{border-style:none;}.mui-style-k1u9gz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-k1u9gz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-k1u9gz:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-k1u9gz:hover{background-color:transparent;}}.mui-style-k1u9gz.Mui-disabled{color:rgba(0, 0, 0, 0.26);}.mui-style-6xugel{display:inherit;margin-right:8px;margin-left:-4px;}.mui-style-6xugel>*:nth-of-type(1){font-size:20px;}.mui-style-1k33q06{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.25rem;}.mui-style-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}.mui-style-1x1vlev{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;margin-bottom:0.35em;color:rgba(0, 0, 0, 0.6);}.mui-style-vax71z{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;margin-top:16px;margin-bottom:16px;}</style><link rel="preload" href="/_next/static/css/345ff263c1768dbb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/345ff263c1768dbb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-5b2299ded1a46c83.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4f0aaa3a6ba99024.js" defer=""></script><script src="/_next/static/chunks/34-75ae01f5fa578a9a.js" defer=""></script><script src="/_next/static/chunks/995-1a3bc1a098c2d99b.js" defer=""></script><script src="/_next/static/chunks/771-6a778ea1fc3e748f.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blang%5D/blog/%5Bslug%5D-0f929ec094b5fc83.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_buildManifest.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="MuiBox-root mui-style-17ro72p"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation3 mui-style-1cp6o32"><div class="MuiBox-root mui-style-79elbk"><div style="position:fixed;top:22px;right:15px;z-index:1300"><span class="MuiSwitch-root MuiSwitch-sizeMedium mui-style-1qo0fs4"><span class="MuiButtonBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked PrivateSwitchBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked Mui-checked mui-style-1uf4bbi"><input class="PrivateSwitchBase-input MuiSwitch-input mui-style-1m9pwf3" type="checkbox" checked=""/><span class="MuiSwitch-thumb mui-style-19gndve"></span></span><span class="MuiSwitch-track mui-style-1ju1kxc"></span></span></div><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary mui-style-k1u9gz" tabindex="0" href="/cn/"><span class="MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium mui-style-6xugel"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall mui-style-1k33q06" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"></path></svg></span>返回列表</a><h1 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom mui-style-gtvj52">android开发中模拟系统内存不足 应用释放的情况.md</h1><p class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom mui-style-1x1vlev">几年后回看会觉得写的太烂<!-- --> | <!-- --> 2015/09/02 00:25:03</p><hr class="MuiDivider-root MuiDivider-fullWidth mui-style-vax71z"/><div class="markdown-body"><p>title: android开发中模拟系统内存不足 应用释放的情况
date: 2015/09/02 00:25:03
updated: 2016/01/14 11:07:01
categories:</p>
<ul>
<li>技术</li>
</ul>
<hr/>
<h2>android开发中模拟系统内存不足 应用释放的情况</h2>
<hr/>
<p>android的开发就是这个吊样子，什么时候释放，没有任何的消息，或者通知你，就直接把你的内存释放了。这给很多开发人员来说，都是不小的压力，往往我们开发的时候，很努力的去保存act，frag中的每一个字段，在页面恢复的时候，再恢复，来保证恢复时原来的页面的数据还在。</p>
<blockquote>
<p>Application中虽然有几个方法是提示内存有些不足了，但是，仔细去测试发现他们效果还是不好，具体细节不做赘述，自行测试。</p>
</blockquote>
<h1></h1>
<p>我们努力，尽心尽力的去写代码，来迎接这种不是每次都会出现的释放的问题，但是想要测试释放的问题的时候，似乎就没法再测试了，因为要再很极端的情况下系统才会把很久很久都没打开的，还在内存中的应用释放掉，那么，这样子很难进行测试。</p>
<blockquote>
<p>后来我也在寻找怎么测试这个吊问题，（在南京呆惯了，喜欢用diao这个词，hahaha），我一直用的方法都是手机上安装很多很多的应用，要测项目中的某个act的时候，我都是要把这个act打开，按下home键，退到后台之后，然后打开微信，QQ，360手机助手，一堆的软件，打开之后都是按下home键让他占着内存，由于我们自己的项目是很久之前打开的，所以当系统的内存变得紧张时，系统就会按照这个顺序，把之前的我们自己的项目给释放掉。我再打开自己的项目，他就会从那个页面开始恢复。</p>
</blockquote>
<p>这样子测试带来的问题，就是在大内存的手机上很难测试，然后我就不断的去google搜索有没有通过adb命令来释放的，如下是我搜到的一些结果：</p>
<p>查到一个命令</p>
<p>adb shell am force-stop 包名</p>
<p>但是这个的作用类似于直接杀死应用，而不是释放应用内存的感觉。</p>
<p>查到这个命令</p>
<pre><code>adb shell  kill  应用的PID
</code></pre>
<p>但是报错：
Operation not permitted  操作不允许了擦擦擦</p>
<h1></h1>
<pre><code>当再as（android studio的简称）的ddms面板上看到  terminates application的时候，我好像看到这个红色的“X”按钮有用，可以释放应用。
</code></pre>
<h2>ok，这个是第一种方法。</h2>
<hr/>
<p>其实我对这种方法并不感冒，我想应该有更优雅的方法。所以继续寻找更好的方案。</p>
<p>当我去按照AS里ddms插件里的这两个单词&quot;terminates application&quot;搜索的时候没搜索到可用的命令，因为搜到的和上面的几个命令都一样。</p>
<h1></h1>
<p>之后我又按照&quot;terminates application&quot;这个关键词去搜索：搜到这个帖子：
<a href="http://www.cnblogs.com/feisky/archive/2010/01/01/1637566.html">http://www.cnblogs.com/feisky/archive/2010/01/01/1637566.html</a></p>
<p>其中有这么一句话：</p>
<blockquote>
<p>Immediately destroy activities：告诉系统一旦一个activity停止了就销毁该activity（例如当Android释放内存的时候）。这对于测试代码onFreeze(Bundle)/onCreate(android.os.Bundle)是非常有用的，否则会比较困难。如果你的程序没有保存状态，那么选择这个选项很可能会引发很多问题。</p>
</blockquote>
<p>这个是通过 Android SDK创建的模拟器里可以用桌面的dev tools工具来释放应用进行模拟。但是其他的第三方的模拟器，比如海马玩模拟器之类的，我就不敢下定论了。</p>
<h2>ok，这算是第二种方法。</h2>
<hr/>
<p>我用as自带的 terminates application 关闭了应用，这是个窍门。
那么问题来了，那些还在使用eclipse的用户，或者使用低版本的idea开发程序员怎么办呢？对于公司的测试人员怎么办呢？他们也不习惯下载各种开发工具啊。给他拷贝一个adb让他们自己用去测试多好！！！
(+_+)</p>
<h1></h1>
<p>于是我想起来好像 DDMS中也有个 STOP按钮，可以直接销毁应用程序，于是我打开我的机器上的DDMS。</p>
<p>好吧，我的sdk是我之前从我的旧的笔记本里拷贝过来的，由于是ubuntu，很多东西都没有权限调用，我要一点点的改权限才能使用SDK目录下的一些工具。<br/>
我得一点点改文件的权限属性，caocaocao，最后在我的努力下ddms启动起来了。</p>
<p><img src="assets/562616e438f4115c7a000beb.PNG" alt=""/></p>
<pre><code>我试了下stop按钮，好像效果 是一样。这个功能应该是和as，idea自带的那个关闭按钮一样的功能吧。
</code></pre>
<h2>这个算是第三种方法。</h2>
<hr/>
<p>但是。这样子 不够高端，不够装逼，  我要玩命令，我要玩命令，我要玩命令，于是慢慢在找命令。而且上面测试人员用ddms了，那他们如果不开ddms或许会有更方便的办法。直接用adb命令去测试多好！！！每次只需要按下方向键上，回到上一个命令，然后按下回车，OK了！！多爽！！！！（+_+）</p>
<h1></h1>
<p>停一下，我想了想，AS底部的stop按钮好像也是属于AS自带的DDMS插件。那我这么努力的去adb命令里面照好像也是没有吊用吧。</p>
<h1></h1>
<p>好吧！慢慢找ddms的命令吧！起码现在不用命令也能模拟应用被释放的情况了。</p>
<h1></h1>
<p>在google 搜索“ddms stop process”， 然后我招到了这个帖子：  <a href="http://stackoverflow.com/questions/11365301/how-to-simulate-android-killing-my-process">点击跳转stackflow</a></p>
<p>里面提到了这个命令：</p>
<pre><code class="language-shell">		adb shell am kill 包名
</code></pre>
<p>经过测试，只要应用再后台的时候，我执行这个命令释放我的项目，app就会重现应用被释放的情况。app在前台的话无法重现这个情况。</p>
<p>经过 测试发现 这个命令还可以释放其他非自己的项目的app，
我用命令：</p>
<pre><code> adb shell pm list packages
</code></pre>
<p>读取到本机安装的应用列表，然后释放掉腾讯的应用宝 ，发现也是可以的。
而不管在ddms插件下，还是ddms里面，都只能释放自己的应用。这个方法蛮 好的。</p>
<h1></h1>
<p>这个就是第四种方法。适用范围广，太棒了，这个才是我想要的终极方案！！！也是最优雅的方案。</p>
<p>还是那句话：</p>
<blockquote>
<p>编程能力就是解决问题的速度和优雅度。</p>
</blockquote>
<hr/>
<p>其实，在我最开始的时候搜索不到的时候，我也去以前的一个QQ群里询问过，不过群里面的技术水平都是中下等，我在里面一直都是回答问题的，问这个问题的时候，大家都回答不上来，还老是说好高端。cacaca 要你们何用？</p>
<h1></h1>
<p>so。问题解决了，其实我写了这么多不是为了告诉读者答案，而是在告诉更多的人，对于有些技术上的困难，不要轻言放弃，给自己几天得时间去查询摸索，终究会有结果。</p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"android开发中模拟系统内存不足 应用释放的情况","title":"android开发中模拟系统内存不足 应用释放的情况.md","mdsource":"md/android开发中模拟系统内存不足 应用释放的情况.md","date":" 2015/09/02 00:25:03","category":"几年后回看会觉得写的太烂"},"content":"title: android开发中模拟系统内存不足 应用释放的情况\ndate: 2015/09/02 00:25:03\nupdated: 2016/01/14 11:07:01\ncategories:\n- 技术\n---\n## android开发中模拟系统内存不足 应用释放的情况\n\n\n----------\nandroid的开发就是这个吊样子，什么时候释放，没有任何的消息，或者通知你，就直接把你的内存释放了。这给很多开发人员来说，都是不小的压力，往往我们开发的时候，很努力的去保存act，frag中的每一个字段，在页面恢复的时候，再恢复，来保证恢复时原来的页面的数据还在。\n\n\u003e Application中虽然有几个方法是提示内存有些不足了，但是，仔细去测试发现他们效果还是不好，具体细节不做赘述，自行测试。\n# \n我们努力，尽心尽力的去写代码，来迎接这种不是每次都会出现的释放的问题，但是想要测试释放的问题的时候，似乎就没法再测试了，因为要再很极端的情况下系统才会把很久很久都没打开的，还在内存中的应用释放掉，那么，这样子很难进行测试。\n\n\u003e后来我也在寻找怎么测试这个吊问题，（在南京呆惯了，喜欢用diao这个词，hahaha），我一直用的方法都是手机上安装很多很多的应用，要测项目中的某个act的时候，我都是要把这个act打开，按下home键，退到后台之后，然后打开微信，QQ，360手机助手，一堆的软件，打开之后都是按下home键让他占着内存，由于我们自己的项目是很久之前打开的，所以当系统的内存变得紧张时，系统就会按照这个顺序，把之前的我们自己的项目给释放掉。我再打开自己的项目，他就会从那个页面开始恢复。  \n\n这样子测试带来的问题，就是在大内存的手机上很难测试，然后我就不断的去google搜索有没有通过adb命令来释放的，如下是我搜到的一些结果：\n\n\n\n查到一个命令\n\n adb shell am force-stop 包名\n\n但是这个的作用类似于直接杀死应用，而不是释放应用内存的感觉。\n\n查到这个命令\n\n\tadb shell  kill  应用的PID\n\n但是报错：\nOperation not permitted  操作不允许了擦擦擦 \n# \n\t当再as（android studio的简称）的ddms面板上看到  terminates application的时候，我好像看到这个红色的“X”按钮有用，可以释放应用。\n## ok，这个是第一种方法。\n\n----------\n其实我对这种方法并不感冒，我想应该有更优雅的方法。所以继续寻找更好的方案。\n\n当我去按照AS里ddms插件里的这两个单词\"terminates application\"搜索的时候没搜索到可用的命令，因为搜到的和上面的几个命令都一样。\n# \n\n 之后我又按照\"terminates application\"这个关键词去搜索：搜到这个帖子： \n http://www.cnblogs.com/feisky/archive/2010/01/01/1637566.html \n\n其中有这么一句话：\n\n\u003e Immediately destroy activities：告诉系统一旦一个activity停止了就销毁该activity（例如当Android释放内存的时候）。这对于测试代码onFreeze(Bundle)/onCreate(android.os.Bundle)是非常有用的，否则会比较困难。如果你的程序没有保存状态，那么选择这个选项很可能会引发很多问题。\n\n\n这个是通过 Android SDK创建的模拟器里可以用桌面的dev tools工具来释放应用进行模拟。但是其他的第三方的模拟器，比如海马玩模拟器之类的，我就不敢下定论了。\n\n\n## ok，这算是第二种方法。\n\n----------\n\n我用as自带的 terminates application 关闭了应用，这是个窍门。\n那么问题来了，那些还在使用eclipse的用户，或者使用低版本的idea开发程序员怎么办呢？对于公司的测试人员怎么办呢？他们也不习惯下载各种开发工具啊。给他拷贝一个adb让他们自己用去测试多好！！！\n(+_+)\n\n# \n于是我想起来好像 DDMS中也有个 STOP按钮，可以直接销毁应用程序，于是我打开我的机器上的DDMS。\n\n好吧，我的sdk是我之前从我的旧的笔记本里拷贝过来的，由于是ubuntu，很多东西都没有权限调用，我要一点点的改权限才能使用SDK目录下的一些工具。  \n我得一点点改文件的权限属性，caocaocao，最后在我的努力下ddms启动起来了。\n\n![](assets/562616e438f4115c7a000beb.PNG)\n\n\n\t我试了下stop按钮，好像效果 是一样。这个功能应该是和as，idea自带的那个关闭按钮一样的功能吧。\n\n## 这个算是第三种方法。\n\n----------\n但是。这样子 不够高端，不够装逼，  我要玩命令，我要玩命令，我要玩命令，于是慢慢在找命令。而且上面测试人员用ddms了，那他们如果不开ddms或许会有更方便的办法。直接用adb命令去测试多好！！！每次只需要按下方向键上，回到上一个命令，然后按下回车，OK了！！多爽！！！！（+_+）\n# \n停一下，我想了想，AS底部的stop按钮好像也是属于AS自带的DDMS插件。那我这么努力的去adb命令里面照好像也是没有吊用吧。\n# \n好吧！慢慢找ddms的命令吧！起码现在不用命令也能模拟应用被释放的情况了。\n# \n在google 搜索“ddms stop process”， 然后我招到了这个帖子：  [点击跳转stackflow](http://stackoverflow.com/questions/11365301/how-to-simulate-android-killing-my-process)\n\n里面提到了这个命令：\n```shell\n\t\tadb shell am kill 包名\n```\n经过测试，只要应用再后台的时候，我执行这个命令释放我的项目，app就会重现应用被释放的情况。app在前台的话无法重现这个情况。\n\n经过 测试发现 这个命令还可以释放其他非自己的项目的app，\n我用命令：\n\t\n\t adb shell pm list packages\n读取到本机安装的应用列表，然后释放掉腾讯的应用宝 ，发现也是可以的。\n而不管在ddms插件下，还是ddms里面，都只能释放自己的应用。这个方法蛮 好的。\n\n# \n这个就是第四种方法。适用范围广，太棒了，这个才是我想要的终极方案！！！也是最优雅的方案。\n\n还是那句话：\n\u003e  编程能力就是解决问题的速度和优雅度。\n\n----------\n其实，在我最开始的时候搜索不到的时候，我也去以前的一个QQ群里询问过，不过群里面的技术水平都是中下等，我在里面一直都是回答问题的，问这个问题的时候，大家都回答不上来，还老是说好高端。cacaca 要你们何用？\n# \nso。问题解决了，其实我写了这么多不是为了告诉读者答案，而是在告诉更多的人，对于有些技术上的困难，不要轻言放弃，给自己几天得时间去查询摸索，终究会有结果。\n\n\n","lang":"cn"},"__N_SSG":true},"page":"/[lang]/blog/[slug]","query":{"lang":"cn","slug":"android开发中模拟系统内存不足 应用释放的情况"},"buildId":"lw2IExpT7GBLnCqajAO6w","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>