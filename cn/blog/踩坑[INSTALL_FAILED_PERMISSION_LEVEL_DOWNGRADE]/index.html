<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><meta name="emotion-insertion-point" content=""/><title>踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE].md<!-- --> - BruceWind&#x27;s Blog</title><meta name="description" content="踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE].md - 几年后回看会觉得写的太烂"/><meta property="og:title" content="踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE].md"/><meta property="og:type" content="article"/><meta property="article:published_time" content=" 2016/06/19 01:22:36"/><meta name="next-head-count" content="8"/><meta charSet="utf-8"/><meta name="keywords" content="NDK,JNI,Android Dev,android,androidyuan,性能优化,Linux,developer"/><meta name="description" content="BruceWind&#x27;s personal blog - Android development, Linux, and more."/><meta name="robots" content="index,follow"/><meta name="google" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="author" content="bruce"/><link rel="icon" href="/favicon.ico"/><meta name="theme-color" content="#000000"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LGE1LT9YJG"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-LGE1LT9YJG');
              </script><style data-emotion="mui-style-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-style 17ro72p 1cp6o32 79elbk 1qo0fs4 1uf4bbi 1m9pwf3 19gndve 1ju1kxc k1u9gz 6xugel 1k33q06 gtvj52 1x1vlev vax71z">.mui-style-17ro72p{width:100%;min-height:100vh;background-color:#fff;padding:16px;}.mui-style-1cp6o32{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12);padding:24px;}.mui-style-79elbk{position:relative;}.mui-style-1qo0fs4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;width:58px;height:38px;overflow:hidden;padding:12px;box-sizing:border-box;position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;z-index:0;vertical-align:middle;width:62px;height:34px;padding:7px;margin:8px;}@media print{.mui-style-1qo0fs4{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1qo0fs4 .MuiSwitch-switchBase{margin:1px;padding:0;-webkit-transform:translateX(6px);-moz-transform:translateX(6px);-ms-transform:translateX(6px);transform:translateX(6px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked{color:#fff;-webkit-transform:translateX(22px);-moz-transform:translateX(22px);-ms-transform:translateX(22px);transform:translateX(22px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked .MuiSwitch-thumb:before{background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><path d="M0 0h24v24H0z" fill="none"/><path fill="white" d="M12 19a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5.5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm11 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13 2v2h6v2h-1.968a18.222 18.222 0 0 1-3.621 6.302 14.685 14.685 0 0 0 5.327 3.042l-.536 1.93A16.685 16.685 0 0 1 12 13.726a16.696 16.696 0 0 1-6.202 3.547l-.536-1.929a14.7 14.7 0 0 0 5.327-3.042 18.077 18.077 0 0 1-2.822-4.3h2.24A16.031 16.031 0 0 0 12 10.876a16.168 16.168 0 0 0 2.91-4.876L5 6V4h6V2h2z"/></g></svg>');}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked+.MuiSwitch-track{opacity:1;background-color:#aab4be;}.mui-style-1qo0fs4 .MuiSwitch-thumb{background-color:#001e3c;width:32px;height:32px;}.mui-style-1qo0fs4 .MuiSwitch-thumb:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none" /><path fill="white" d="M14 10h2v.757a4.5 4.5 0 0 1 7 3.743V20h-2v-5.5c0-1.43-1.175-2.5-2.5-2.5S16 13.07 16 14.5V20h-2V10zm-2-6v2H4v5h8v2H4v5h8v2H2V4h10z"/></svg>');}.mui-style-1qo0fs4 .MuiSwitch-track{opacity:1;background-color:#aab4be;border-radius:10px;}.mui-style-1uf4bbi{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;padding:9px;border-radius:50%;position:absolute;top:0;left:0;z-index:1;color:#fff;-webkit-transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,-webkit-transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.mui-style-1uf4bbi::-moz-focus-inner{border-style:none;}.mui-style-1uf4bbi.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-1uf4bbi{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1uf4bbi.Mui-checked{-webkit-transform:translateX(20px);-moz-transform:translateX(20px);-ms-transform:translateX(20px);transform:translateX(20px);}.mui-style-1uf4bbi.Mui-disabled{color:#f5f5f5;}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{opacity:0.5;}.mui-style-1uf4bbi.Mui-disabled+.MuiSwitch-track{opacity:0.12;}.mui-style-1uf4bbi .MuiSwitch-input{left:-100%;width:300%;}.mui-style-1uf4bbi:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.mui-style-1uf4bbi:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked{color:#1976d2;}.mui-style-1uf4bbi.Mui-checked:hover{background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-1uf4bbi.Mui-checked:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked.Mui-disabled{color:rgb(167, 202, 237);}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{background-color:#1976d2;}.mui-style-1m9pwf3{cursor:inherit;position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;margin:0;padding:0;z-index:1;}.mui-style-19gndve{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);background-color:currentColor;width:20px;height:20px;border-radius:50%;}.mui-style-1ju1kxc{height:100%;width:100%;border-radius:7px;z-index:-1;-webkit-transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;background-color:#000;opacity:0.38;}.mui-style-k1u9gz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;margin-bottom:16px;}.mui-style-k1u9gz::-moz-focus-inner{border-style:none;}.mui-style-k1u9gz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-k1u9gz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-k1u9gz:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-k1u9gz:hover{background-color:transparent;}}.mui-style-k1u9gz.Mui-disabled{color:rgba(0, 0, 0, 0.26);}.mui-style-6xugel{display:inherit;margin-right:8px;margin-left:-4px;}.mui-style-6xugel>*:nth-of-type(1){font-size:20px;}.mui-style-1k33q06{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.25rem;}.mui-style-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}.mui-style-1x1vlev{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;margin-bottom:0.35em;color:rgba(0, 0, 0, 0.6);}.mui-style-vax71z{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;margin-top:16px;margin-bottom:16px;}</style><link rel="preload" href="/_next/static/css/345ff263c1768dbb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/345ff263c1768dbb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-5b2299ded1a46c83.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4f0aaa3a6ba99024.js" defer=""></script><script src="/_next/static/chunks/34-75ae01f5fa578a9a.js" defer=""></script><script src="/_next/static/chunks/995-1a3bc1a098c2d99b.js" defer=""></script><script src="/_next/static/chunks/771-6a778ea1fc3e748f.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blang%5D/blog/%5Bslug%5D-0f929ec094b5fc83.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_buildManifest.js" defer=""></script><script src="/_next/static/lw2IExpT7GBLnCqajAO6w/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="MuiBox-root mui-style-17ro72p"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation3 mui-style-1cp6o32"><div class="MuiBox-root mui-style-79elbk"><div style="position:fixed;top:22px;right:15px;z-index:1300"><span class="MuiSwitch-root MuiSwitch-sizeMedium mui-style-1qo0fs4"><span class="MuiButtonBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked PrivateSwitchBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary Mui-checked Mui-checked mui-style-1uf4bbi"><input class="PrivateSwitchBase-input MuiSwitch-input mui-style-1m9pwf3" type="checkbox" checked=""/><span class="MuiSwitch-thumb mui-style-19gndve"></span></span><span class="MuiSwitch-track mui-style-1ju1kxc"></span></span></div><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary mui-style-k1u9gz" tabindex="0" href="/cn/"><span class="MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium mui-style-6xugel"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall mui-style-1k33q06" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"></path></svg></span>返回列表</a><h1 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom mui-style-gtvj52">踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE].md</h1><p class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom mui-style-1x1vlev">几年后回看会觉得写的太烂<!-- --> | <!-- --> 2016/06/19 01:22:36</p><hr class="MuiDivider-root MuiDivider-fullWidth mui-style-vax71z"/><div class="markdown-body"><p>title: 踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE]
date: 2016/06/19 01:22:36
updated: 2016/07/14 22:50:47
categories:</p>
<ul>
<li>技术</li>
</ul>
<hr/>
<p>情况是这样子的：
产品反馈：从1.4版本升级到2.0,发现提示<strong>应用未安装</strong>。我去什么鬼！！！
当时上线时都测试了，怎么会出现呢！擦擦擦！</p>
<h1></h1>
<h2>按照以往的经验：</h2>
<p>1.常见都是签名问题。
2.文件下载不完整，这种情况有的手机会显示<strong>未安装</strong>,有的手机显示出<strong>解析包错误</strong>。</p>
<h1></h1>
<h2>这个问题是怎么找到根源的</h2>
<p>其实当时确实怀疑了签名问题，so，找个apk读取签名的工具，以前用过一个叫做<code>Gen_signature_Android.apk</code>微信支付官方就有读取某个安装的应用的apk的签名文件MD5，<a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419319167&amp;token=&amp;lang=zh_CN">链接在此点我跳转</a>
分别安装了两个版本，用Gen_signature工具读取每个版本的签名的md5,发现都是相同的。没什么卵用。不是签名问题。</p>
<h1></h1>
<p>后来详细的测试，发现只有6.0的机器会发生这个情况。怪不得当时没有测试出来。</p>
<h1></h1>
<h2>命令安装,如果发生失败起码会给我显示失败原因</h2>
<p>想到命令安装,如果失败起码会给我失败的原因。这会是一个好的突破点。</p>
<p>就用360手机助手导出了手机安装的apk包，当然我没有windows 没有手机助手，好想命令也可以导出apk，但是时间不多来不及解释了。导出之后再下载一个最新版。</p>
<p>先用命令尝试安装老的包</p>
<pre><code>adb install xxx.apk
//轻松安装成功
</code></pre>
<p>然后安装新版本的。</p>
<pre><code>adb install -r  xxx.apk
//打印如下
Faild [INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE]
</code></pre>
<p><strong>DOWNGRADE</strong>这个单词比较特别，压根就没见过。
我擦，</p>
<p>dict 命令翻译了一下：</p>
<pre><code>weideAir:~ wei$ dict DOWNGRADE
###################################
#  downgrade 降级 (U: ,daʊn&#x27;ɡred E: &#x27;daʊngreɪd; daʊn&#x27;greɪd )
#  n. 退步；下坡
#  adj. 下坡的
#  vt. 使降级（过去式downgraded，过去分词downgraded，现在分词downgrading，第三人称单数downgrades）；小看
#  adv. 下坡地
###################################
</code></pre>
<p>是降级的意思。我擦，竟然是这样子的。
查了下网上给的方案都是versioncode，仔细对比versioncode是没问题的草草草！！</p>
<p>公司的一位领导坐我旁边说这个“可能是跟权限有关”。
那么唯一有关的就只是targetversion，targetversion会影响app在制定版本的api的手机上的运行的效果这个倒是真的，之前就读过国内一些博客所说的targetversion的概念。</p>
<h1></h1>
<p>于是用aapt命令读取两个apk包的targetversion分别是多少。</p>
<pre><code>aapt dump baging ***.apk
</code></pre>
<p>1.4版本是<code>23</code>，2.0是<code>19</code>。那很可能是这里的问题。</p>
<h1></h1>
<p>重新打包测试了下,确定了是这个问题，只要修改targetversion为23之后，就可以覆盖1。4版本安装，不再报错了。</p>
<h1></h1>
<p>只是一开始不去怀疑这点，确实是因为之前的一些项目修改这个，确实都没有发生过什么问题。现在在6.0上开始不让修改了这个消息还真不知道。</p>
<h2>深沉的检讨</h2>
<pre><code>4.1当时项目发一个版本发版时更改了targetversion，必须得承认这是我的错误。毋庸置疑！ 我的锅！
</code></pre>
<h2>深深的甩锅给谷歌</h2>
<p>以前也经常改这个字段，从没发生过问题。5.0降级还没有任何问题呢！官方总要给点提示吧！而且直接guge搜DOWNGRADE错误给出的答案都是versioncode。 难道因为我这里是china？？
我这里就信息封闭！！！
于是去android devrloper官方：
<a href="https://developer.android.com/guide/topics/manifest/uses-sdk-element.html">https://developer.android.com/guide/topics/manifest/uses-sdk-element.html</a>
文章给了一堆的targetversion的原理的介绍。并没有写出android 6.0之后这个targetversion就不能再降级了。
我擦！！！大爷的！！！你妹啊！你可是官方啊！！！官方都不给这个坑的提示。。。你们不要拦着我，我要转IOS开发！！！</p>
<p>欣慰的是这个错误导致的人数并不多，当时发版本的时候市面上android 6.0的机器并不多。很难买到6.0的机器。华为算是国内最早的发布6.0 的机器的厂商了，他们发布的时候也都到了16年年初了。</p>
<h1>业内到底有多少人不知道这个坑？</h1>
<p>我平时也有订阅一些android方面的周报的习惯，一些新的技术，比如android 6.0的运行时权限很早也有关注，也写过demo。但是这个坑实在是没有发现有人写过，所以这篇博客po出来的目的就是在此，希望后人不要踩坑。</p>
<p><img src="assets/downgrade3.png" alt=""/></p>
<p><img src="assets/downgrade4.png" alt=""/></p>
<p><img src="assets/downgrade1.png" alt=""/></p>
<p><img src="assets/downgrade2.png" alt=""/></p>
<h1>如上：截图时搜索并没有筛选时间，截图过了才想起来需要过滤筛选一下时间为一年内的，但是实际上筛选了一样没有搜到有说6.0手机targetversion不能降级的。</h1>
<hr/>
<h3>似乎目前没有任何博客和文章说过android 6.0不能随意的更改targetversion，那我发现了就贡献出来，这就是这片文章出现在你面前的原因。</h3></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE]","title":"踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE].md","mdsource":"md/踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE].md","date":" 2016/06/19 01:22:36","category":"几年后回看会觉得写的太烂"},"content":"title: 踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE]\ndate: 2016/06/19 01:22:36\nupdated: 2016/07/14 22:50:47\ncategories:\n- 技术\n---\n情况是这样子的：\n产品反馈：从1.4版本升级到2.0,发现提示**应用未安装**。我去什么鬼！！！\n当时上线时都测试了，怎么会出现呢！擦擦擦！\n# \n## 按照以往的经验：\n1.常见都是签名问题。\n2.文件下载不完整，这种情况有的手机会显示**未安装**,有的手机显示出**解析包错误**。\n\n# \n## 这个问题是怎么找到根源的 \n其实当时确实怀疑了签名问题，so，找个apk读取签名的工具，以前用过一个叫做`Gen_signature_Android.apk`微信支付官方就有读取某个安装的应用的apk的签名文件MD5，[链接在此点我跳转](https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list\u0026t=resource/res_list\u0026verify=1\u0026id=open1419319167\u0026token=\u0026lang=zh_CN)\n分别安装了两个版本，用Gen_signature工具读取每个版本的签名的md5,发现都是相同的。没什么卵用。不是签名问题。\n\n# \n后来详细的测试，发现只有6.0的机器会发生这个情况。怪不得当时没有测试出来。\n# \n## 命令安装,如果发生失败起码会给我显示失败原因\n\n想到命令安装,如果失败起码会给我失败的原因。这会是一个好的突破点。\n\n就用360手机助手导出了手机安装的apk包，当然我没有windows 没有手机助手，好想命令也可以导出apk，但是时间不多来不及解释了。导出之后再下载一个最新版。\n\n先用命令尝试安装老的包\n```\nadb install xxx.apk\n//轻松安装成功\n```\n然后安装新版本的。\n```\nadb install -r  xxx.apk\n//打印如下\nFaild [INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE]\n```\n**DOWNGRADE**这个单词比较特别，压根就没见过。\n我擦，\n\ndict 命令翻译了一下：\n```\nweideAir:~ wei$ dict DOWNGRADE\n###################################\n#  downgrade 降级 (U: ,daʊn'ɡred E: 'daʊngreɪd; daʊn'greɪd )\n#  n. 退步；下坡\n#  adj. 下坡的\n#  vt. 使降级（过去式downgraded，过去分词downgraded，现在分词downgrading，第三人称单数downgrades）；小看\n#  adv. 下坡地\n###################################\n```\n是降级的意思。我擦，竟然是这样子的。\n查了下网上给的方案都是versioncode，仔细对比versioncode是没问题的草草草！！\n\n公司的一位领导坐我旁边说这个“可能是跟权限有关”。\n那么唯一有关的就只是targetversion，targetversion会影响app在制定版本的api的手机上的运行的效果这个倒是真的，之前就读过国内一些博客所说的targetversion的概念。\n\n#\n于是用aapt命令读取两个apk包的targetversion分别是多少。\n\n```\naapt dump baging ***.apk\n```\n1.4版本是`23`，2.0是`19`。那很可能是这里的问题。\n# \n重新打包测试了下,确定了是这个问题，只要修改targetversion为23之后，就可以覆盖1。4版本安装，不再报错了。\n\n# \n只是一开始不去怀疑这点，确实是因为之前的一些项目修改这个，确实都没有发生过什么问题。现在在6.0上开始不让修改了这个消息还真不知道。\n\n## 深沉的检讨\n    4.1当时项目发一个版本发版时更改了targetversion，必须得承认这是我的错误。毋庸置疑！ 我的锅！\n\n## 深深的甩锅给谷歌\n以前也经常改这个字段，从没发生过问题。5.0降级还没有任何问题呢！官方总要给点提示吧！而且直接guge搜DOWNGRADE错误给出的答案都是versioncode。 难道因为我这里是china？？\n我这里就信息封闭！！！\n于是去android devrloper官方：\nhttps://developer.android.com/guide/topics/manifest/uses-sdk-element.html\n文章给了一堆的targetversion的原理的介绍。并没有写出android 6.0之后这个targetversion就不能再降级了。\n我擦！！！大爷的！！！你妹啊！你可是官方啊！！！官方都不给这个坑的提示。。。你们不要拦着我，我要转IOS开发！！！\n\n欣慰的是这个错误导致的人数并不多，当时发版本的时候市面上android 6.0的机器并不多。很难买到6.0的机器。华为算是国内最早的发布6.0 的机器的厂商了，他们发布的时候也都到了16年年初了。\n\n# 业内到底有多少人不知道这个坑？\n我平时也有订阅一些android方面的周报的习惯，一些新的技术，比如android 6.0的运行时权限很早也有关注，也写过demo。但是这个坑实在是没有发现有人写过，所以这篇博客po出来的目的就是在此，希望后人不要踩坑。\n\n![](assets/downgrade3.png)\n\n![](assets/downgrade4.png)\n\n![](assets/downgrade1.png)\n\n![](assets/downgrade2.png)\n# 如上：截图时搜索并没有筛选时间，截图过了才想起来需要过滤筛选一下时间为一年内的，但是实际上筛选了一样没有搜到有说6.0手机targetversion不能降级的。\n----------------\n### 似乎目前没有任何博客和文章说过android 6.0不能随意的更改targetversion，那我发现了就贡献出来，这就是这片文章出现在你面前的原因。\n\n\n\n","lang":"cn"},"__N_SSG":true},"page":"/[lang]/blog/[slug]","query":{"lang":"cn","slug":"踩坑[INSTALL_FAILED_PERMISSION_LEVEL_DOWNGRADE]"},"buildId":"lw2IExpT7GBLnCqajAO6w","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>