{"pageProps":{"post":{"slug":"junit-with-js-test","title":"Junit test with JS","mdsource":"en_mds/junit-with-js-test.md","date":"2022/07/26 23:45:24","category":"Blogs"},"content":"title: Junit test with JS\ndate: 2022/07/26 23:45:24\ncategories:\n- 技术\n---\n\nWhen you write **hybrid app**, you may need to decipher one type of data in two kind of languages such as Java and JS.\nAnd in this case, you must want to execute unit test for test an indentical data for these language codes be cause it is important \nto test two language codes with an idendical data. In this aritcle, I show you one way to test JS functions in **JUnit**.\n\n\nFollow steps below, I show you how to done it.\n\n\nFirst step, we need to prepare for it.\n\n1. Import this JS sourse directory into **JUnit** environment.\n\n2. Modify gradle to import **rhino**, and import JS\n```\nandroid {\n    sourceSets {\n        test {\n            resources.srcDirs += ['../web-app/src/components/utils/'] //working for junit test.\n        }\n    }\n}\n\n// import dependence for JS runtime engine.\ntestImplementation 'org.mozilla:rhino:1.7.14'\n```\n\n\n\n``` JavaScript\nconst actionList = [];\n\nfunction setActionList(list, isTesting){\n    if(!Array.isArray(list)) return;\n\n    if (actionList.length > 0) actionList.splice(0, actionList.length);\n    if(list.length>0){\n        list.forEach(item => {\n            if(item.posArray.length > 0){\n                actionList.push(item);\n            }\n        }\n        );\n    }\n\n    //this line below is used for junit.\n    if(isTesting) return JSON.stringify(actionList);\n}\n\n\n```\n\n``` kotlin\n    // a method to read text file.\n    @Throws(IOException::class)\n    fun readFromFile(filename: String?): String? {\n        val `is`: InputStream? = javaClass.getResourceAsStream(filename!!)\n        val stringBuilder = StringBuilder()\n        var i: Int =0\n        val b = ByteArray(4096)\n        if (`is` != null) {\n            while (`is`.read(b).also({ i = it }) != -1) {\n                stringBuilder.append(String(b, 0, i))\n            }\n        }\n        return stringBuilder.toString()\n    }\n\n    fun testJSAboutTaskChainDataReceived(sentJSONArr: String) {\n        val rhino = Context.enter()\n        // turn off optimization to work with android\n        rhino.optimizationLevel = -1\n\n        val path = \"/TaskManager.js\"\n        val evaluation = \"2+2\"\n        //to test code, there is no needs to try them.\n        val scope = rhino.initStandardObjects()\n        val result = rhino.evaluateString(scope, evaluation, \"JavaScript\", 1, null).toString()\n        Assert.assertEquals(4f, result.toFloat())\n\n\n        var text = readFromFile(path)?.replace(\"export \", \"\")\n        Assert.assertTrue(text!!.isNotEmpty())\n\n        //dont use \"let\" to define variable in JS, you must use 'const'.\n        text += \" const data = ${sentJSONArr}; setActionList(data);\"\n        val evaluation1 =  text\n        val result1 = rhino.evaluateString(scope, evaluation1, \"JavaScript\", 1, null).toString()\n        Assert.assertEquals(1, JSONArray(result1).length())\n\n    }\n\n```\n\n\n### In addition\n\nIt is notable that I can not use `let` to define a variable. please look into [Rhino official doc about compatibility](https://mozilla.github.io/rhino/compat/engines.html).\n\nSome tips I should talk about:\n1. In some cases, JS would return `undefined` not null so that you may need to care about type of value method `evaluateString()`  returned.\n   \n    Maybe you can [set config file](https://stackoverflow.com/questions/52333240/how-to-specifiy-es-version-within-js-comment-when-using-eslint) to tell eslint that a JS file should accords to ES5. \n    \n2. You can use `String.replace` to convert some ES6 strandard JS code to ES5.","lang":"en"},"__N_SSG":true}