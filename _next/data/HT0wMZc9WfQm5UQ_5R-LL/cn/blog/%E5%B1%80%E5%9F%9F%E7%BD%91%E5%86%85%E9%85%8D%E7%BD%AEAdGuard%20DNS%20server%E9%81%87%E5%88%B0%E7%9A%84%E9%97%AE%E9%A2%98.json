{"pageProps":{"post":{"slug":"%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E9%85%8D%E7%BD%AEAdGuard%20DNS%20server%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98","title":"局域网内配置AdGuard DNS server遇到的问题.md","mdsource":"md/局域网内配置AdGuard DNS server遇到的问题.md","date":" 2019/08/30 13:52:18","category":"几年后回看会觉得写的太烂"},"content":"title: 局域网内配置AdGuard DNS server遇到的问题\ndate: 2019/08/30 13:52:18\nupdated: 2019/08/30 13:55:30\ncategories:\n- 技术\n---\n本文只记录在局域网遇到的问题，类似搭建过程的博客一搜一大堆。机器是ubuntu 16。\n\n\n## 1.报53端口被占用的问题\na.maybe is a bug, 更新到0.95之后的版本，不要要低于0.95, 这里有个历史bug.\n如果你已经安装了那么删除他：\n```\nsudo ./AdGuardHome -s uninstall \n```\n\n\n说不定真的有程序占用了端口，用这个命令去查一下那个端口占用了。\n```\nsudo netstat -anlp | grep -w LISTEN  \n\n```\n\nb.如果还不行，请安装**fiewalld**，然后设置几个端口可以被使用。\n```\nsudo apt install firewalld \n\n#firewalld放行53端口\nsudo firewall-cmd --zone=public --add-port=53/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=53/udp --permanent\nsudo firewall-cmd --reload\n#iptables放行53端口\nsudo iptables -A INPUT -p tcp --dport 53 -j ACCEPT\nsudo iptables -A INPUT -p udp --dport 53 -j ACCEPT\n\n#放行3000端口（AdGuardHome初始化需要使用）\n#firewalld放行3000端口\nsudo firewall-cmd --zone=public --add-port=3000/tcp --permanent\nsudo firewall-cmd --reload\n#iptables放行3000端口\nsudo iptables -A INPUT -p tcp --dport 3000 -j ACCEPT\nservice iptables save\n```\n我自己这里是特么的ubuntu的dnsmasq程序占用了端口。\n```\nsudo vi /etc/NetworkManager/NetworkManager.conf\n\n//注释这行重启server即可\n#dns=dnsmasq\n```\n\n## 2.启用关闭 服务\n``` shell \n//启动\nsystemctl start AdGuardHome\n//\n\n开机自启\n\nsystemctl enable AdGuardHome\n//重启\nsystemctl restart AdGuardHome\n//停止\nsystemctl stop AdGuardHome\n```\n\n\n\n\n","lang":"cn"},"__N_SSG":true}