{"pageProps":{"post":{"slug":"printallsizesofdependencies.md","title":"PrintAllSizesOfDependencies.md","mdsource":"https://gist.githubusercontent.com/BruceWind/0bf231688c77fafef0b7e4e42f940084/raw/9ccfd039ce19646daf6e38572ba8b2bfbdb6b578/PrintAllSizesOfDependencies.md","date":"2020-10-13T06:16:34Z","category":"Gists"},"content":"```\n/* Tested with Gradle gradle-6.6.1-all.zip and gradle plugin 4.0.2 */\n\n\nallprojects {\n    repositories {\n        afterEvaluate {\n    \n        tasks.register(\"depsize-all-configurations\") {\n            description = 'Prints dependencies for all available configurations'\n            doLast() {\n                    configurations\n                    .findAll { it.isCanBeResolved() }\n                    .each { listConfigurationDependencies(it) }\n                    }\n                 }\n        }\n}\n//...\n\n\ndef listConfigurationDependencies(Configuration configuration) {\n    def configurationWhichSaveToMarkdown = \"_classStructurekaptDebugKotlin\"\n    def formatStr = \"%,10.2f\"\n\n    def size = configuration.collect { it.length() / (1024 * 1024) }.sum()\n\n    def Date now = new Date()\n\n    def out = new StringBuffer()\n    out << \"\\n  Date :${now.getDateString()}  \\n   Configuration name: \\\"${configuration.name}\\\"\\n\"\n    if (size) {\n        out << '\\nTotal dependencies size:'.padRight(65)\n        out << \"${String.format(formatStr, size)} Mb\\n\\n\"\n\n        out << '| file   |      size      |\\n'\n        out << '|----------|------:|\\n'\n        configuration.sort { -it.length() }\n                .each {\n                    String name = it.name\n                    if(name == \"classes.jar\"){//this name is not clear, I have to print its parent dir name.\n                        File file = it.getAbsoluteFile()\n                        while (file.parentFile!=null){\n                            if (file.name==\"build\"){\n                                file = file.parentFile\n                                name = file.getName() +\"/build/.../\" + name\n                                break\n                            }\n                            file = file.parentFile\n                        }\n                    }\n                    out << \"| ${name} \".padRight(65)\n                    out << \"| ${String.format(formatStr, (it.length() / 1024))} kb |\\n\"\n                }\n    } else {\n        out << 'No dependencies found';\n    }\n    println(out)\n    if (configuration.name == configurationWhichSaveToMarkdown) {\n        new File(projectDir, \"all_libs.md\").text = out\n    }\n}\n\n\n\n```","lang":"en"},"__N_SSG":true}