title: ubuntu虚拟内存使用的配置
date: 2016/04/02 01:21:47
updated: 2016/04/05 00:25:31
categories:
- 技术
---
因为把ubuntu做到了U盘中，希望带着我的操作系统到处跑，到任何一台机器插上去开机即工作，不管是thinkpad还是mac都可以run。但是U盘因为读写流是单通道的问题，本身ubuntu内核本身对硬盘读写需求并不大的，但是使用过程，妈蛋，老子U盘发热量大啊！！！！！还好我的U盘是三星最新款闪存盘，经得起高温。单通道U盘经不起这么折腾，使用过程很明显机器卡了，打开资源管理器一看，IO流阻塞严重，IO占用率达到90%，我日。
妈的。老子得想办法关闭虚拟内存，windows上我玩的6，直接系统配置里就行了，感觉到linux下必须要装逼，要高端啊！
哈哈哈 ！

###　1.查看系统 swappiness 的配置  这个命令一般返回的都是60

``` shell 
cat /proc/sys/vm/swappiness
```

### 2. 修改 swappiness 值 ,如下命令，临时修改一下，重启之后恢复默认
``` shell
sudo sysctl vm.swappiness=6
```

### 3.修改默认配置　

``` shell
sudo gedit /etc/sysctl.conf
```

文档的尾部追加:
```
vm.swappiness=6
```
---------------- im a beaauty line. --------------
And u need  reboot:

``` shell
sudo reboot 
```
OK了。  重启之后 机器再也没卡了。就算我写这个文章时，同时启动而IDEA，IDEA启动过程打开着我们公司一个大型的Android项目，Gradle构建缓慢，打着字也不卡了，66的。

### Swappiness 在ubuntu wiki官网上的解释：
> 以下内容摘选自ubunt wiki.

Swappiness 参数控制内核将进程从物理内存和交换磁盘上移的趋势。因为磁盘比内存慢得多，如果系统积极的移除内存，这会导致系统和应用程序的响应时间变慢。

swappiness 可以具有介于 0 和 100 之间的值
`swappiness = 0`      告诉内核尽可能长时间避免交换物理内存的过程
`swappiness = 100`    告诉内核积极交换物理内存的进程，并将它们交换缓存移动
# 
swappiness在 Ubuntu 的默认设置是 swappiness = 60。
减少 swappiness 的默认值可能会提高整体表现为典型的 Ubuntu 桌面安装。值为 swappiness = 10 建议，但感觉自由地去尝试。注意 ︰ Ubuntu 服务器安装具有不同的性能要求对桌面系统，和 60 的默认值是可能更合适。检查 swappiness 值

-------------------
实现和配置说完了，可能有些同学不懂交换空间是个什么鬼我们来说一下原理吧：
# 
### 什么是Swap（交换空间）？
> 以下内容摘选自ubunt wiki.

交换空间是计算机的在硬盘上，这是计算机的可访问的物理内存 (RAM) 的组合和交换空间的虚拟内存的一部分地区。交换空间暂时认为是不活跃的内存页。您的系统决定所需要的活动进程的物理内存，并有可用的未使用的物理内存不足时，将使用交换空间。如果系统碰巧需要更多的内存资源或空间，不活动的页面在物理内存中然后被移动到交换空间因此释放物理内存用于其他用途。注意到，访问时间交换是慢因此做不认为它是完整的替换为的物理内存。交换空间可以是专用的交换分区 （推荐）、 交换文件或交换分区和交换文件的组合。
# 
### 示例场景
> 摘选自ubunt wiki.

低 RAM 和磁盘空间不足与 512 MB 内存和 30 GB 的硬盘，使用 512 MB 为交换，因为 RAM 是非常低。低 RAM 和较高的磁盘空间与 512 MB RAM 和 100 GB 的硬盘，使用 1 GB 交换，因为 RAM 是非常低，并且硬盘空间是在很多。高 RAM 和磁盘空间不足与 2 GB RAM 30 GB 的硬盘，使用 1 GB 交换，因为硬盘空间是非常低。高的 RAM 和较高的磁盘空间与 2 GB RAM 和 100 GB 的硬盘，使用 2 GB 为交换，因为硬盘空间是丰富。

### 妈蛋！！！为何没有提到8G内存的情况，老子我8G内存的机器还需要不需要设置？你倒是说啊！！！！  
虽然，ubuntu官方wiki上没说，但是和明显他这里意思是**8G**这种大内存的机器可有可无，很多情况下，机器全部的软件开启，内存的消耗达不到**8G**这个数值，chrome标签多开的话，影响就很大了。内存消耗就会开始猛增。anroi软件开发，gradle构建一大的情况下，完蛋，机器内存消耗超高。windows下的时候，以前上大学经常习惯性关闭虚拟内存。windows是直接可以配置虚拟内存最大限制数，很方便，只有特殊情况下内存才会爆掉，提示1分钟后自动关机，比如 系统更新时间。

# 补充一句话，年轻，就是折腾！

------------
## 本文引用Ubuntu Wiki链接如下：
http://wiki.ubuntu.org.cn/UbuntuHelp:SwapFaq
