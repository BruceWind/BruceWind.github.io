title: 优雅的查询android下一个目录的大小
date: 2018/12/04 22:38:08
updated: 2018/12/05 10:28:23
categories:
- 技术
---
### 先问你自己个问题：
### android下我需要获取一个文件夹的大小，怎么获取？

当然不管你是用google还是百度：

给你的方案都是自己写java代码去遍历子目录，一层层的遍历，获取每一个文件的大小。很显然，这里的for循环逻辑比较深，而且不管的查询获取,获取之后，是展示k b m还是long型值都需要再写逻辑，整体下来执行的步骤就太长了。



### 所以我想着用其他方案取获取：
> 我本人总是喜欢用一些奇淫的技巧去解决问题，所以我懒得写这么多代码。我还是想要简单的方案，最终选择了命令行。

首先，android可以直接执行命令行，然后读取输出字符串。这是一种很好的方案。
而且命令行本身提供很大的可玩性，你要做遍历时对一些文件做忽略，等等操作都可以做，不管你需要1m,1M,1k,1K,自动改变结尾单位k，m，g都可以做，命令行基本上可以满足您的所有需求。以后即使需求变更，你也可以只是通过修改一两个字符串即可，甚至这个代码都不用做测试，因为都是linux通用命令行。

我这里是du命令，可能你会想到命令行会不会有兼容问题，准确来说没有，因为android底层都是linux，du命令是linux内置的命令，不会有兼容问题，几乎不会有linux发行版本会修改du命令。


## 我的代码如下，
```  java 
private void testForShell(){

    String[] cmd = {
            "du -sh /sdcard/tencent/ | cut -f1"
    };
    ShellUtils.CommandResult result = ShellUtils.execCommand(cmd);
    Log.d("SIZE",result.successMsg);
}
    
```
我用du -sh，du提供的`sh`参数会帮我计算好是K M G 所以我不用再单独处理单位，du命令玩法很多，当然你可能说一个du命令的参数无法满足你的特殊需求，你倒是可以选择配合其他命令。

> 这里的ShellUtils代码并没有贴出来，你可以去github找别人写好的，一般项目里都有这种工具类，不需要再添加了。所以我就不贴了，对于我的项目来说我只写了`du -sh /sdcard/tencent/ | cut -f1`就获取到了文件夹的大小。





## PS：性能对比
你是否会觉得这个方法可能会比java的递归循环遍历查询目录**执行速度更快**？
`然而并没有`，du命令执行的是C语言去遍历目录，跟你用java做递归遍历执行逻辑是一样的。只是纯粹的java可能在cpu执行上的速度会慢于C，毕竟C编译为机器码了，但是当前逻辑并没有大的CPU计算。反而，你启动一个command需要执行命令行的IO等待时间更多，所以Java执行耗时<=du命令行执行的耗时。所以，当子文件夹的数量越多，他们俩耗时就越接近，这是我的预测
。
### 然后我自己去测试了下：
测试上面腾讯的，还有空目录的，还有整个sdcard目录的。结果跟我的猜测是一样的，但是目前来即使空目录性能差的毫秒数并不多，10+ms而已，所以基本可以接受，而且本来你就开了线程去处理，所以时间可以接受，另外就是易用性而言命令行远大于写纯java代码，另外就是代码耦合度，优雅程度也自然是命令行更合适。

**所以，换做是我，我会选择用java执行命令行去查询目录大小。**

# 

### PS：查看一下我手机里疼熏这个目录下,一共有多少个子目录，多少个文件?

``` shell
$ ls -lR| grep "^d" | wc -l
473
$ ls -lR|grep "^-"|wc -l
1678
```
子目录和子目录就是473个子目录。。。。1678个文件




