<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1, width=device-width"/><meta name="emotion-insertion-point" content=""/><title>AndroidRemoteBuildWithDocker<!-- --> - BruceWind&#x27;s Blog</title><meta name="description" content="AndroidRemoteBuildWithDocker - Open-source"/><meta property="og:title" content="AndroidRemoteBuildWithDocker"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2021-09-10"/><meta name="next-head-count" content="8"/><meta charSet="utf-8"/><meta name="keywords" content="NDK,JNI,Android Dev,android,androidyuan,性能优化,Linux,developer"/><meta name="description" content="BruceWind&#x27;s personal blog - Android development, Linux, and more."/><meta name="robots" content="index,follow"/><meta name="google" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="author" content="bruce"/><link rel="icon" href="/favicon.ico"/><meta name="theme-color" content="#000000"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LGE1LT9YJG"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-LGE1LT9YJG');
              </script><style data-emotion="mui-style-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="mui-style 17ro72p 1cp6o32 79elbk 1qo0fs4 1uf4bbi 1m9pwf3 19gndve 1ju1kxc k1u9gz 6xugel 1k33q06 gtvj52 1x1vlev vax71z">.mui-style-17ro72p{width:100%;min-height:100vh;background-color:#fff;padding:16px;}.mui-style-1cp6o32{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12);padding:24px;}.mui-style-79elbk{position:relative;}.mui-style-1qo0fs4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;width:58px;height:38px;overflow:hidden;padding:12px;box-sizing:border-box;position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;z-index:0;vertical-align:middle;width:62px;height:34px;padding:7px;margin:8px;}@media print{.mui-style-1qo0fs4{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1qo0fs4 .MuiSwitch-switchBase{margin:1px;padding:0;-webkit-transform:translateX(6px);-moz-transform:translateX(6px);-ms-transform:translateX(6px);transform:translateX(6px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked{color:#fff;-webkit-transform:translateX(22px);-moz-transform:translateX(22px);-ms-transform:translateX(22px);transform:translateX(22px);}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked .MuiSwitch-thumb:before{background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><path d="M0 0h24v24H0z" fill="none"/><path fill="white" d="M12 19a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5.5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm11 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13 2v2h6v2h-1.968a18.222 18.222 0 0 1-3.621 6.302 14.685 14.685 0 0 0 5.327 3.042l-.536 1.93A16.685 16.685 0 0 1 12 13.726a16.696 16.696 0 0 1-6.202 3.547l-.536-1.929a14.7 14.7 0 0 0 5.327-3.042 18.077 18.077 0 0 1-2.822-4.3h2.24A16.031 16.031 0 0 0 12 10.876a16.168 16.168 0 0 0 2.91-4.876L5 6V4h6V2h2z"/></g></svg>');}.mui-style-1qo0fs4 .MuiSwitch-switchBase.Mui-checked+.MuiSwitch-track{opacity:1;background-color:#aab4be;}.mui-style-1qo0fs4 .MuiSwitch-thumb{background-color:#001e3c;width:32px;height:32px;}.mui-style-1qo0fs4 .MuiSwitch-thumb:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background-repeat:no-repeat;-webkit-background-position:center;background-position:center;background-image:url('data:image/svg+xml;utf8,<?xml version="1.0" ?><svg height="20" width="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none" /><path fill="white" d="M14 10h2v.757a4.5 4.5 0 0 1 7 3.743V20h-2v-5.5c0-1.43-1.175-2.5-2.5-2.5S16 13.07 16 14.5V20h-2V10zm-2-6v2H4v5h8v2H4v5h8v2H2V4h10z"/></svg>');}.mui-style-1qo0fs4 .MuiSwitch-track{opacity:1;background-color:#aab4be;border-radius:10px;}.mui-style-1uf4bbi{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;padding:9px;border-radius:50%;position:absolute;top:0;left:0;z-index:1;color:#fff;-webkit-transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,-webkit-transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:left 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,transform 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.mui-style-1uf4bbi::-moz-focus-inner{border-style:none;}.mui-style-1uf4bbi.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-1uf4bbi{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-1uf4bbi.Mui-checked{-webkit-transform:translateX(20px);-moz-transform:translateX(20px);-ms-transform:translateX(20px);transform:translateX(20px);}.mui-style-1uf4bbi.Mui-disabled{color:#f5f5f5;}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{opacity:0.5;}.mui-style-1uf4bbi.Mui-disabled+.MuiSwitch-track{opacity:0.12;}.mui-style-1uf4bbi .MuiSwitch-input{left:-100%;width:300%;}.mui-style-1uf4bbi:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.mui-style-1uf4bbi:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked{color:#1976d2;}.mui-style-1uf4bbi.Mui-checked:hover{background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-1uf4bbi.Mui-checked:hover{background-color:transparent;}}.mui-style-1uf4bbi.Mui-checked.Mui-disabled{color:rgb(167, 202, 237);}.mui-style-1uf4bbi.Mui-checked+.MuiSwitch-track{background-color:#1976d2;}.mui-style-1m9pwf3{cursor:inherit;position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;margin:0;padding:0;z-index:1;}.mui-style-19gndve{box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);background-color:currentColor;width:20px;height:20px;border-radius:50%;}.mui-style-1ju1kxc{height:100%;width:100%;border-radius:7px;z-index:-1;-webkit-transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;background-color:#000;opacity:0.38;}.mui-style-k1u9gz{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;margin-bottom:16px;}.mui-style-k1u9gz::-moz-focus-inner{border-style:none;}.mui-style-k1u9gz.Mui-disabled{pointer-events:none;cursor:default;}@media print{.mui-style-k1u9gz{-webkit-print-color-adjust:exact;color-adjust:exact;}}.mui-style-k1u9gz:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.mui-style-k1u9gz:hover{background-color:transparent;}}.mui-style-k1u9gz.Mui-disabled{color:rgba(0, 0, 0, 0.26);}.mui-style-6xugel{display:inherit;margin-right:8px;margin-left:-4px;}.mui-style-6xugel>*:nth-of-type(1){font-size:20px;}.mui-style-1k33q06{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.25rem;}.mui-style-gtvj52{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;}.mui-style-1x1vlev{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:0.875rem;line-height:1.43;letter-spacing:0.01071em;margin-bottom:0.35em;color:rgba(0, 0, 0, 0.6);}.mui-style-vax71z{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;margin-top:16px;margin-bottom:16px;}</style><link rel="preload" href="/_next/static/css/345ff263c1768dbb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/345ff263c1768dbb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-5b2299ded1a46c83.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4f0aaa3a6ba99024.js" defer=""></script><script src="/_next/static/chunks/34-75ae01f5fa578a9a.js" defer=""></script><script src="/_next/static/chunks/995-a5f98cc3a4d14286.js" defer=""></script><script src="/_next/static/chunks/771-702e6dcd51d5534b.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blang%5D/blog/%5Bslug%5D-c0566a06cafc2ea3.js" defer=""></script><script src="/_next/static/zaycUZ6jvMLykcBwRP9wT/_buildManifest.js" defer=""></script><script src="/_next/static/zaycUZ6jvMLykcBwRP9wT/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="MuiBox-root mui-style-17ro72p"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation3 mui-style-1cp6o32"><div class="MuiBox-root mui-style-79elbk"><div style="position:fixed;top:22px;right:15px;z-index:1300"><span class="MuiSwitch-root MuiSwitch-sizeMedium mui-style-1qo0fs4"><span class="MuiButtonBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary PrivateSwitchBase-root MuiSwitch-switchBase MuiSwitch-colorPrimary mui-style-1uf4bbi"><input class="PrivateSwitchBase-input MuiSwitch-input mui-style-1m9pwf3" type="checkbox"/><span class="MuiSwitch-thumb mui-style-19gndve"></span></span><span class="MuiSwitch-track mui-style-1ju1kxc"></span></span></div><a class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorPrimary mui-style-k1u9gz" tabindex="0" href="/en/"><span class="MuiButton-icon MuiButton-startIcon MuiButton-iconSizeMedium mui-style-6xugel"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall mui-style-1k33q06" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"></path></svg></span>Back to list</a><h1 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom mui-style-gtvj52">AndroidRemoteBuildWithDocker</h1><p class="MuiTypography-root MuiTypography-body2 MuiTypography-gutterBottom mui-style-1x1vlev">Open-source<!-- --> | <!-- -->2021-09-10</p><hr class="MuiDivider-root MuiDivider-fullWidth mui-style-vax71z"/><div class="markdown-body"><h1>AndroidRemoteBuildWithDocker</h1>
<p><a href="https://github.com/BruceWind/AndroidRemoteBuildWithDocker/blob/main/README_zh.md">简体中文</a></p>
<p>Some people building large Android projects on laptops may got depressed in building costs such as time and battery usage.
So some people have the need of a powerful and portable workstation. It is impossible but you can build on remote desktop.</p>
<p>The trouble was on me as well, however, I fixed it. I used to establish a remote-builder on my powerful desktop. I control the remote-builder by not only terminal but also Android studio.
A problem is that remote-builder configuring with Android will spend lots time. In building it on a cloud service or new desktop, tremendous steps of configuration make me tired. So I made this repo integrate with a couple of technologies: virtualization technolgy and a remote-builder tool.</p>
<p><a href="https://github.com/buildfoundation/mainframer">Mainframer</a>, the remote-builder tool is can do two things:  syncing files and executing build commands. Its official explain:</p>
<blockquote>
<p>A tool that executes a command on a remote machine while syncing files back and forth. The process is known as remote execution (in general) and remote build (in particular cases).
It works via pushing files to the remote machine, executing the command there and pulling results to the local machine.</p>
</blockquote>
<p>And I have to tell you that it work not only temrinal but also Android studio.</p>
<p>Before I said that remote-builder configuring with Android will spend lots time but we have virtualization technology, such as <code>Docker</code> and <code>Kubernetes</code>, which I&#x27;ve used in everywhere is high-performance and easy to use and backup.
<em><strong>In this repo, I make a docker image that contains Android develop environment and <a href="https://github.com/buildfoundation/mainframer">Mainframer</a></strong></em>.
You can run it on a powerful/high-performance desktop which can be a server. It is not required that the desktop/server and your laptop <strong>under one LAN</strong>. In case the desktop/server you can connect from anywhere, it can be set the docker image. Furthermore, you can put the docker image on a cloud service, such as, google or amazon cloud server, for your remote and powerful building. Cloud services are elastic in performance and price. Besides, you may think cloud server is high-latency. I have to explain that latency won&#x27;t affect your build experience because the host does not communicate with your laptop multiple times during the build process, except during the first build. Copying files only in before and after buiding build. And the full-file-copying task only once.</p>
<p>To sum up, I explained that the repo works for remote-building and it solve troubles about laptop&#x27;s performance and battery. So after you establish a remote-builder, you can bring you laptop to coffee shop, grass and sunshine without electric charging.</p>
<p>Below I explain how to set up it.</p>
<h2>Server configuration</h2>
<details><summary>click to expand</summary>
<p>First step is building docker image. In your terminal, run this command <code>docker build -t mainframer-docker .</code></p>
<p>Last step is starting it: run <code>docker run --restart always -d -p 23:22 mainframer-docker</code>.</p>
<p>Now, if there is no error,  run <code>docker container ls | grep mainframer-docker</code> to detect if it is started. May everything is very well.</p>
</details>
<h2>Client configuration</h2>
<details><summary>click to expand</summary>
<p>Beside the project specific setup we need 2 more things, an ssh-key that is used to easily communicate between client and server. And a ssh configuration for our server.</p>
<pre><code class="language-bash">ssh-keygen -t rsa -f ~/.ssh/remote-builder -q -N &quot;&quot;
# for mac, you may need to  run: brew install ssh-copy-id
# At the next command, you must input the password:root for ssh-copy
ssh-copy-id -i ~/.ssh/remote-builder  -p 23 root@127.0.0.1

echo -e &quot;Host remote_builder
          User root 
          HostName 127.0.0.1 
          Port 23 
          IdentityFile ~/.ssh/remote-builder 
          PreferredAuthentications publickey 
          ControlMaster auto 
          ControlPath /tmp/%r@%h:%p 
          ControlPersist 1h&quot; &gt;&gt; ~/.ssh/config
</code></pre>
<p><strong>DONT FORGET TO REPLACE IP ADDRESS</strong></p>
<p>To verify the SSH configuration of the docker works very well, you can run: <code>ssh remote_builder</code>. If there is no error, the ssh-conf must be correct.</p>
<p>For Android you can now copy the folder  <code>.mainframer</code> and file <code>./mainframer.sh</code> into your project folder. Then you can run <code>bash ./mainframer.sh ./gradlew assembleDebug</code> to make sure it works ok.</p>
<p><strong>And now enjoy faster builds</strong></p>
<p>Btw, you might like to run this within your Android Studio or Jetbrian IDEA. Please follow steps below:</p>
<h3>Build with Android Studio</h3>
<ol>
<li>
<p>open Android Studio to open your project.</p>
</li>
<li>
<p>click <strong>Run → Edit Configuration → +</strong>.</p>
</li>
<li>
<p>select your <strong>Android App</strong>.</p>
</li>
<li>
<p>name a new name, e.g. remote-build.</p>
</li>
<li>
<p>in <strong>Module</strong>, select submodule name, may be <code>app</code>.</p>
</li>
<li>
<p>in <strong>Before Launch</strong>, click <strong>-</strong> to delete <code>Gradle-aware Make</code></p>
</li>
<li>
<p>in <strong>Before Launch</strong>, click <strong>+</strong>, add <strong>Run External Tool</strong>, input a new name，like <code>remote assembleDebug</code>.</p>
</li>
<li>
<p>in <strong>Program</strong>, input <code>bash</code>.</p>
</li>
<li>
<p>in <strong>Parameters</strong> input <code>mainframer.sh ./gradlew :app:assembleDebug -Pandroid.enableBuildCache=true</code></p>
</li>
<li>
<p>The last step, in <strong>Working directory</strong> , input <code>$ProjectFileDir$</code>.</p>
</li>
</ol>
</details>
<h2>In addition</h2>
<p><strong>How to install another SDK?</strong></p>
<blockquote>
<p>In most circumstances, you don&#x27;t need to do it. SDK downloading will automatically execute。</p>
</blockquote>
<p>Modify Dockerfile to rebuild. Or follow these steps:</p>
<ol>
<li>
<p>start your docker.</p>
</li>
<li>
<p>run <code>ssh remote_builder</code> to enter your docker container. Or use the docker command to enter it.</p>
</li>
<li>
<p>by the time you entered the bash on your docker container, run:</p>
<p><code>/sdk/tools/bin/sdkmanager--install &quot;ndk;21.0.6113669&quot; --channel=3</code>.</p>
</li>
</ol>
<p><strong>Mainframer also can build other kinds of projects</strong>
You can fork this project to edit <code>Dockerfile</code> to make it work for your project.</p>
<p><strong>More features of Mainframer:</strong>
<a href="https://github.com/buildfoundation/mainframer/tree/v2.1.0/samples/gradle-android">mainframer/v2.1.0 doc</a></p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"androidremotebuildwithdocker","title":"AndroidRemoteBuildWithDocker","mdsource":"https://raw.githubusercontent.com/BruceWind/AndroidRemoteBuildWithDocker/master/README.md","date":"2021-09-10","category":"Open-source"},"content":"# AndroidRemoteBuildWithDocker\n\n[简体中文](https://github.com/BruceWind/AndroidRemoteBuildWithDocker/blob/main/README_zh.md)\n\nSome people building large Android projects on laptops may got depressed in building costs such as time and battery usage.\nSo some people have the need of a powerful and portable workstation. It is impossible but you can build on remote desktop.\n\nThe trouble was on me as well, however, I fixed it. I used to establish a remote-builder on my powerful desktop. I control the remote-builder by not only terminal but also Android studio.\nA problem is that remote-builder configuring with Android will spend lots time. In building it on a cloud service or new desktop, tremendous steps of configuration make me tired. So I made this repo integrate with a couple of technologies: virtualization technolgy and a remote-builder tool.\n\n[Mainframer](https://github.com/buildfoundation/mainframer), the remote-builder tool is can do two things:  syncing files and executing build commands. Its official explain: \n\u003e A tool that executes a command on a remote machine while syncing files back and forth. The process is known as remote execution (in general) and remote build (in particular cases).\n\u003e It works via pushing files to the remote machine, executing the command there and pulling results to the local machine.\n\nAnd I have to tell you that it work not only temrinal but also Android studio.\n\nBefore I said that remote-builder configuring with Android will spend lots time but we have virtualization technology, such as `Docker` and `Kubernetes`, which I've used in everywhere is high-performance and easy to use and backup. \n***In this repo, I make a docker image that contains Android develop environment and [Mainframer](https://github.com/buildfoundation/mainframer)***. \nYou can run it on a powerful/high-performance desktop which can be a server. It is not required that the desktop/server and your laptop **under one LAN**. In case the desktop/server you can connect from anywhere, it can be set the docker image. Furthermore, you can put the docker image on a cloud service, such as, google or amazon cloud server, for your remote and powerful building. Cloud services are elastic in performance and price. Besides, you may think cloud server is high-latency. I have to explain that latency won't affect your build experience because the host does not communicate with your laptop multiple times during the build process, except during the first build. Copying files only in before and after buiding build. And the full-file-copying task only once.\n\nTo sum up, I explained that the repo works for remote-building and it solve troubles about laptop's performance and battery. So after you establish a remote-builder, you can bring you laptop to coffee shop, grass and sunshine without electric charging. \n\nBelow I explain how to set up it.\n\n## Server configuration\n\u003cdetails\u003e\u003csummary\u003eclick to expand\u003c/summary\u003e\n\nFirst step is building docker image. In your terminal, run this command `docker build -t mainframer-docker .`\n\nLast step is starting it: run `docker run --restart always -d -p 23:22 mainframer-docker`. \n\nNow, if there is no error,  run `docker container ls | grep mainframer-docker` to detect if it is started. May everything is very well.\n\u003c/details\u003e\n\n## Client configuration\n\u003cdetails\u003e\u003csummary\u003eclick to expand\u003c/summary\u003e\n  \nBeside the project specific setup we need 2 more things, an ssh-key that is used to easily communicate between client and server. And a ssh configuration for our server.\n\n  ```bash\n  ssh-keygen -t rsa -f ~/.ssh/remote-builder -q -N \"\"\n  # for mac, you may need to  run: brew install ssh-copy-id\n  # At the next command, you must input the password:root for ssh-copy\n  ssh-copy-id -i ~/.ssh/remote-builder  -p 23 root@127.0.0.1\n\n  echo -e \"Host remote_builder\n            User root \n            HostName 127.0.0.1 \n            Port 23 \n            IdentityFile ~/.ssh/remote-builder \n            PreferredAuthentications publickey \n            ControlMaster auto \n            ControlPath /tmp/%r@%h:%p \n            ControlPersist 1h\" \u003e\u003e ~/.ssh/config\n  ```\n  **DONT FORGET TO REPLACE IP ADDRESS**\n\nTo verify the SSH configuration of the docker works very well, you can run: `ssh remote_builder`. If there is no error, the ssh-conf must be correct.\n\nFor Android you can now copy the folder  `.mainframer` and file `./mainframer.sh` into your project folder. Then you can run `bash ./mainframer.sh ./gradlew assembleDebug` to make sure it works ok.\n\n**And now enjoy faster builds**\n\nBtw, you might like to run this within your Android Studio or Jetbrian IDEA. Please follow steps below:\n\n### Build with Android Studio\n\n1. open Android Studio to open your project.\n\n3. click **Run → Edit Configuration → +**.\n\n4. select your **Android App**.\n\n5. name a new name, e.g. remote-build.\n\n6. in **Module**, select submodule name, may be `app`.\n\n7. in **Before Launch**, click **-** to delete `Gradle-aware Make`\n\n8. in **Before Launch**, click **+**, add **Run External Tool**, input a new name，like `remote assembleDebug`.\n\n9.  in **Program**, input `bash`.\n\n10. in **Parameters** input `mainframer.sh ./gradlew :app:assembleDebug -Pandroid.enableBuildCache=true`\n\n11. The last step, in **Working directory** , input `$ProjectFileDir$`.\n\n\n\u003c/details\u003e\n\n## In addition\n\n**How to install another SDK?**\n\n\u003e In most circumstances, you don't need to do it. SDK downloading will automatically execute。\n\nModify Dockerfile to rebuild. Or follow these steps:\n\n1. start your docker.\n2. run `ssh remote_builder` to enter your docker container. Or use the docker command to enter it.\n3. by the time you entered the bash on your docker container, run: \n\n    `/sdk/tools/bin/sdkmanager--install \"ndk;21.0.6113669\" --channel=3`.\n\n**Mainframer also can build other kinds of projects**\nYou can fork this project to edit `Dockerfile` to make it work for your project.\n\n\n\n**More features of Mainframer:**\n[mainframer/v2.1.0 doc](https://github.com/buildfoundation/mainframer/tree/v2.1.0/samples/gradle-android)\n","lang":"en"},"__N_SSG":true},"page":"/[lang]/blog/[slug]","query":{"lang":"en","slug":"androidremotebuildwithdocker"},"buildId":"zaycUZ6jvMLykcBwRP9wT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>